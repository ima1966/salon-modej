<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚µãƒ­ãƒ³ Mode J å£²ä¸Šç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  v13.13</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans JP', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            text-align: center;
        }

        .header h1 {
            color: #667eea;
            font-size: 26px;
            font-weight: 700;
            display: flex;
            align-items: baseline;
            justify-content: center;
            gap: 10px;
        }

        .header h1 .version {
            font-size: 14px;
            font-weight: 500;
            color: #999;
            opacity: 0.8;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab-btn {
            flex: 1;
            min-width: 120px;
            padding: 15px 20px;
            background: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .tab-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .tab-content {
            display: none;
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
            font-size: 14px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 14px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            font-family: 'Noto Sans JP', sans-serif;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 600px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        .customer-info-section {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            border: 2px solid #667eea;
        }

        /* v13.10: å£²ä¸Šå…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä¸­å¤®é…ç½® */
        #sales-form {
            max-width: 900px;
            margin: 0 auto;
        }

        .items-section {
            background: #f9fafb;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .items-section h3 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 18px;
        }

        .item-row {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border: 2px solid #e0e0e0;
            position: relative;
        }

        .item-row-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .item-row-number {
            font-weight: 700;
            color: #667eea;
            font-size: 16px;
        }

        .btn-remove-item {
            background: #ef4444;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            font-weight: 500;
        }

        .btn-remove-item:hover {
            background: #dc2626;
        }

        .btn-add-item {
            width: 100%;
            padding: 14px;
            background: #10b981;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 20px;
        }

        .btn-add-item:hover {
            background: #059669;
            transform: translateY(-2px);
        }

        .total-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 25px;
            border-radius: 10px;
            color: white;
            margin-bottom: 20px;
        }

        .total-section-header {
            font-size: 16px;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .total-section-amount {
            font-size: 36px;
            font-weight: 700;
        }

        .btn-primary {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .payment-methods {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        @media (max-width: 600px) {
            .payment-methods {
                grid-template-columns: 1fr;
            }
        }

        .payment-option {
            padding: 14px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .payment-option:hover {
            border-color: #667eea;
        }

        .payment-option.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .payment-option.cash.selected {
            background: #10b981;
            border-color: #10b981;
        }

        .payment-option.transfer.selected {
            background: #3b82f6;
            border-color: #3b82f6;
        }

        .payment-option.credit.selected {
            background: #f59e0b;
            border-color: #f59e0b;
        }

        .sales-list {
            margin-top: 20px;
            overflow-x: auto;
        }

        .sales-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .sales-table thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .sales-table th {
            padding: 15px 12px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
        }

        .sales-table tbody tr {
            border-bottom: 1px solid #e5e7eb;
            transition: background 0.2s;
        }

        .sales-table tbody tr:hover {
            background: #f9fafb;
        }

        .sales-table td {
            padding: 12px;
            font-size: 14px;
            color: #333;
        }

        .sales-table-date {
            font-weight: 600;
            color: #667eea;
            white-space: nowrap;
        }

        .sales-table-amount {
            font-weight: 700;
            font-size: 16px;
            white-space: nowrap;
        }

        .sales-table-payment {
            display: flex;
            align-items: center;
            gap: 5px;
            white-space: nowrap;
        }

        .payment-icon {
            font-size: 18px;
        }

        .sales-table-actions {
            display: flex;
            gap: 5px;
            white-space: nowrap;
        }

        .sales-detail-row {
            background: #fefce8 !important;
        }

        .sales-detail-cell {
            padding: 15px !important;
            border-left: 4px solid #667eea;
        }

        .detail-item {
            padding: 8px 0;
            display: flex;
            justify-content: space-between;
            border-bottom: 1px solid #e5e7eb;
        }

        .detail-item:last-child {
            border-bottom: none;
        }

        .detail-category {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            margin-right: 6px;
        }

        .detail-product {
            font-weight: 500;
        }

        .detail-price {
            color: #666;
            font-size: 13px;
        }

        .btn-icon {
            padding: 6px 10px;
            border: none;
            border-radius: 5px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            background: #667eea;
            color: white;
            font-weight: 500;
        }

        .btn-icon:hover {
            opacity: 0.85;
            transform: scale(1.05);
        }

        .btn-icon.btn-detail {
            background: #667eea;
        }

        .btn-icon.btn-detail.active {
            background: #f59e0b;
        }

        .btn-icon.btn-edit {
            background: #3b82f6;
        }

        .btn-icon.btn-delete {
            background: #ef4444;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .dashboard-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 25px;
            border-radius: 15px;
            color: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .dashboard-card h3 {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .dashboard-card .value {
            font-size: 32px;
            font-weight: 700;
        }

        .period-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .period-selector input {
            flex: 1;
            min-width: 150px;
        }

        .period-selector button {
            padding: 14px 30px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 500;
            cursor: pointer;
        }

        .ranking-list {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            border: 1px solid #e5e7eb;
        }

        .ranking-item {
            display: grid;
            grid-template-columns: 50px 1fr 80px 120px;
            gap: 15px;
            align-items: center;
            padding: 14px 10px;
            border-bottom: 1px solid #f0f0f0;
            transition: background 0.2s;
        }

        .ranking-item:hover {
            background: #f8f9ff;
        }

        .ranking-item:last-child {
            border-bottom: none;
        }

        .ranking-number {
            font-weight: 700;
            color: #667eea;
            font-size: 16px;
            text-align: center;
        }

        .ranking-name {
            font-weight: 500;
            color: #333;
            display: flex;
            flex-direction: column;
        }

        .ranking-count {
            font-weight: 600;
            color: #666;
            text-align: right;
            font-size: 14px;
        }

        .ranking-value {
            font-weight: 700;
            color: #667eea;
            text-align: right;
            font-size: 16px;
        }

        .payment-breakdown {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        @media (max-width: 600px) {
            .payment-breakdown {
                grid-template-columns: 1fr;
            }
        }

        .payment-breakdown-item {
            background: #f9fafb;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .payment-breakdown-item .label {
            font-size: 14px;
            color: #666;
            margin-bottom: 8px;
        }

        .payment-breakdown-item .value {
            font-size: 24px;
            font-weight: 700;
        }

        .cash-color { color: #10b981; }
        .transfer-color { color: #3b82f6; }
        .credit-color { color: #f59e0b; }

        .btn-export {
            margin-top: 20px;
            padding: 14px 30px;
            background: #10b981;
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 500;
            cursor: pointer;
            display: inline-block;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .search-box {
            margin-bottom: 20px;
        }

        .search-box input {
            width: 100%;
            padding: 14px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 24px;
            background: #10b981;
            color: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .daily-sales-table {
            width: 100%;
            margin-top: 20px;
            border-collapse: collapse;
        }

        .daily-sales-table th,
        .daily-sales-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        .daily-sales-table th {
            background: #f9fafb;
            font-weight: 700;
            color: #667eea;
        }

        .daily-sales-table tr:hover {
            background: #f9fafb;
        }

        .item-grid {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 10px;
        }

        @media (max-width: 600px) {
            .item-grid {
                grid-template-columns: 1fr;
            }
        }

        /* è¨­å®šã‚¿ãƒ–ç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .settings-section {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 2px solid #667eea;
        }

        .settings-section h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .settings-item {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
        }

        .settings-item label {
            font-weight: 600;
            color: #555;
            display: block;
            margin-bottom: 5px;
        }

        .settings-item .value {
            color: #667eea;
            font-family: monospace;
            font-size: 14px;
            word-break: break-all;
        }

        .btn-settings {
            width: 100%;
            padding: 14px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 10px;
        }

        .btn-settings:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }

        .btn-settings.btn-danger {
            background: #ef4444;
        }

        .btn-settings.btn-danger:hover {
            background: #dc2626;
        }

        .btn-settings.btn-success {
            background: #10b981;
        }

        .btn-settings.btn-success:hover {
            background: #059669;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸŒ¸ ã‚µãƒ­ãƒ³ Mode J å£²ä¸Šç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  <span class="version">v13.13</span></h1>
        </div>

        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('input')">ğŸ“ å£²ä¸Šå…¥åŠ›</button>
            <button class="tab-btn" onclick="switchTab('list')">ğŸ“Š å£²ä¸Šä¸€è¦§</button>
            <button class="tab-btn" onclick="switchTab('dashboard')">ğŸ“ˆ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</button>
            <button class="tab-btn" onclick="switchTab('settings')">âš™ï¸ è¨­å®š</button>
        </div>

        <!-- å£²ä¸Šå…¥åŠ›ã‚¿ãƒ– -->
        <div id="input-tab" class="tab-content active">
            <h2 style="margin-bottom: 25px; color: #667eea; font-size: 32px; font-weight: 700; text-align: center;">ğŸ“ å£²ä¸Šå…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ </h2>
            
            <form id="sales-form">
                <!-- ãŠå®¢æ§˜æƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                <div class="customer-info-section">
                    <h3 style="color: #667eea; margin-bottom: 15px; font-size: 18px;">ğŸ‘¤ ãŠå®¢æ§˜æƒ…å ±</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>æœˆæ—¥ *</label>
                            <input type="date" id="sale-date" required>
                        </div>
                        <div class="form-group">
                            <label>ãŠå®¢æ§˜å *</label>
                            <input type="text" id="customer-name" placeholder="ä¾‹: å±±ç”°æ§˜" required>
                        </div>
                    </div>
                </div>

                <!-- å•†å“ãƒ»æ–½è¡“æ˜ç´°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                <div class="items-section">
                    <h3>ğŸ›ï¸ å•†å“ãƒ»æ–½è¡“æ˜ç´°</h3>
                    <div id="items-container">
                        <!-- æ˜ç´°è¡ŒãŒã“ã“ã«è¿½åŠ ã•ã‚Œã¾ã™ -->
                    </div>
                    <button type="button" class="btn-add-item" id="add-item-btn">â• æ˜ç´°ã‚’è¿½åŠ </button>
                </div>

                <!-- åˆè¨ˆé‡‘é¡è¡¨ç¤º -->
                <div class="total-section">
                    <div class="total-section-header">ãŠæ”¯æ‰•ã„åˆè¨ˆ</div>
                    <div class="total-section-amount" id="grand-total">Â¥0</div>
                </div>

                <!-- æ±ºæ¸ˆæ–¹æ³• -->
                <div class="form-group">
                    <label>æ±ºæ¸ˆæ–¹æ³• *</label>
                    <div class="payment-methods">
                        <div class="payment-option cash" data-value="ç¾é‡‘">ğŸ’µ ç¾é‡‘</div>
                        <div class="payment-option transfer" data-value="æŒ¯è¾¼">ğŸ¦ æŒ¯è¾¼</div>
                        <div class="payment-option credit" data-value="ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰">ğŸ’³ ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰</div>
                    </div>
                    <input type="hidden" id="payment-method" required>
                </div>

                <button type="button" class="btn-primary" id="submit-btn">ğŸ’¾ å£²ä¸Šã‚’ç™»éŒ²</button>
            </form>
        </div>

        <!-- å£²ä¸Šä¸€è¦§ã‚¿ãƒ– -->
        <div id="list-tab" class="tab-content">
            <h2 style="margin-bottom: 25px; color: #667eea; font-size: 32px; font-weight: 700; text-align: center;">ğŸ“Š å£²ä¸Šä¸€è¦§ç®¡ç†</h2>
            
            <!-- æœŸé–“ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
            <div style="background: #f8f9ff; padding: 20px; border-radius: 10px; margin-bottom: 20px; border: 2px solid #667eea;">
                <div style="font-weight: 700; color: #667eea; margin-bottom: 12px; font-size: 16px;">ğŸ“… æœŸé–“ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼</div>
                
                <div style="display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 15px;">
                    <button class="btn-period" onclick="setPeriod('2months-ago', event)" style="padding: 10px 15px; background: white; color: #667eea; border: 2px solid #667eea; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500; transition: all 0.3s;">ğŸ“† å…ˆã€…æœˆ</button>
                    <button class="btn-period" onclick="setPeriod('last-month', event)" style="padding: 10px 15px; background: white; color: #667eea; border: 2px solid #667eea; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500; transition: all 0.3s;">ğŸ“† å…ˆæœˆ</button>
                    <button class="btn-period active" id="period-current-month" onclick="setPeriod('current-month', event)" style="padding: 10px 15px; background: #667eea; color: white; border: 2px solid #667eea; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500; transition: all 0.3s;">ğŸ“† ä»Šæœˆ</button>
                    <button class="btn-period" onclick="setPeriod('this-week', event)" style="padding: 10px 15px; background: white; color: #667eea; border: 2px solid #667eea; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500; transition: all 0.3s;">ğŸ—“ï¸ ä»Šé€±</button>
                    <button class="btn-period" onclick="setPeriod('today', event)" style="padding: 10px 15px; background: white; color: #667eea; border: 2px solid #667eea; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500; transition: all 0.3s;">ğŸ“… æœ¬æ—¥</button>
                </div>
                
                <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                    <span style="font-weight: 600; color: #667eea;">ğŸ“† ä»»æ„æœŸé–“:</span>
                    <input type="date" id="list-period-start" style="padding: 8px 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;">
                    <span style="color: #666;">ã€œ</span>
                    <input type="date" id="list-period-end" style="padding: 8px 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;">
                    <button onclick="applyCustomPeriod()" style="padding: 8px 20px; background: #10b981; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">âœ… é©ç”¨</button>
                    <button onclick="resetListPeriod()" style="padding: 8px 20px; background: #6b7280; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ</button>
                </div>
                
                <div id="current-period-display" style="margin-top: 12px; padding: 10px; background: white; border-radius: 6px; color: #667eea; font-weight: 600; text-align: center;">
                    ç¾åœ¨ã®è¡¨ç¤º: ä»Šæœˆ
                </div>
            </div>
            
            <!-- å¹´é–“æœˆæ¬¡å£²ä¸Šæ¨ç§» -->
            <div style="background: white; padding: 25px; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); border: 2px solid #667eea;">
                <div style="display: flex; justify-content: center; align-items: center; margin-bottom: 20px; gap: 15px;">
                    <h3 style="color: #667eea; font-size: 18px; font-weight: 700; margin: 0;">ğŸ“Š å¹´é–“æœˆæ¬¡å£²ä¸Šæ¨ç§»</h3>
                    <select id="yearly-year-selector" onchange="changeYearDisplay()" style="padding: 8px 12px; border: 2px solid #667eea; border-radius: 8px; font-size: 14px; font-weight: 600; color: #667eea; cursor: pointer; background: white;">
                        <!-- å¹´åº¦ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒã‚¹ã‚¯ãƒªãƒ—ãƒˆã§è¿½åŠ ã•ã‚Œã¾ã™ -->
                    </select>
                </div>
                <div id="yearly-monthly-chart" style="display: grid; grid-template-columns: repeat(12, 1fr); gap: 8px; margin-bottom: 15px; min-height: 240px;">
                    <!-- æœˆæ¬¡ãƒ‡ãƒ¼ã‚¿ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
                </div>
                <div style="text-align: center; padding: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 10px; font-weight: 700; font-size: 18px;">
                    <span style="opacity: 0.9; font-size: 14px;">å¹´é–“åˆè¨ˆ:</span> <span id="yearly-total">Â¥0</span>
                </div>
            </div>
            
            <!-- æœˆé–“æ—¥æ¬¡å£²ä¸Šæ¨ç§» -->
            <div style="background: white; padding: 25px; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); border: 2px solid #764ba2;">
                <h3 style="color: #764ba2; font-size: 18px; font-weight: 700; margin-bottom: 20px; text-align: center;">ğŸ“… æœˆé–“æ—¥æ¬¡å£²ä¸Šæ¨ç§» <span id="monthly-display-period" style="font-size: 20px; margin-left: 10px;"></span></h3>
                <!-- v13.10: æ›œæ—¥ãƒ˜ãƒƒãƒ€ãƒ¼ -->
                <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; margin-bottom: 10px;">
                    <div style="text-align: center; font-weight: 700; color: #ef4444; font-size: 14px; padding: 8px 0;">æ—¥</div>
                    <div style="text-align: center; font-weight: 700; color: #764ba2; font-size: 14px; padding: 8px 0;">æœˆ</div>
                    <div style="text-align: center; font-weight: 700; color: #764ba2; font-size: 14px; padding: 8px 0;">ç«</div>
                    <div style="text-align: center; font-weight: 700; color: #764ba2; font-size: 14px; padding: 8px 0;">æ°´</div>
                    <div style="text-align: center; font-weight: 700; color: #764ba2; font-size: 14px; padding: 8px 0;">æœ¨</div>
                    <div style="text-align: center; font-weight: 700; color: #764ba2; font-size: 14px; padding: 8px 0;">é‡‘</div>
                    <div style="text-align: center; font-weight: 700; color: #3b82f6; font-size: 14px; padding: 8px 0;">åœŸ</div>
                </div>
                <div id="monthly-daily-chart" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; margin-bottom: 15px;">
                    <!-- æ—¥æ¬¡ãƒ‡ãƒ¼ã‚¿ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
                </div>
                <div style="text-align: center; padding: 15px; background: linear-gradient(135deg, #764ba2 0%, #f093fb 100%); color: white; border-radius: 10px; font-weight: 700; font-size: 18px;">
                    <span style="opacity: 0.9; font-size: 14px;">æœˆé–“åˆè¨ˆ:</span> <span id="monthly-total">Â¥0</span> <span style="opacity: 0.8; font-size: 14px; margin-left: 15px;">(<span id="monthly-count">0</span>ä»¶)</span>
                </div>
            </div>
            
            <div class="search-box">
                <input type="text" id="search-input" placeholder="ğŸ” ãŠå®¢æ§˜åã‚„å•†å“åã§æ¤œç´¢...">
            </div>

            <div class="summary-cards" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                <div style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); padding: 20px; border-radius: 10px; color: white; box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);">
                    <div style="font-size: 14px; opacity: 0.9; margin-bottom: 8px;">ğŸ“… ä»Šæ—¥ã®å£²ä¸Š</div>
                    <div id="today-sales" style="font-size: 28px; font-weight: 700; margin-bottom: 5px;">ï¿¥0</div>
                    <div id="today-count" style="font-size: 13px; opacity: 0.85;">0ä»¶</div>
                </div>
                <div style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); padding: 20px; border-radius: 10px; color: white; box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);">
                    <div style="font-size: 14px; opacity: 0.9; margin-bottom: 8px;">ğŸ—“ï¸ ä»Šé€±ã®å£²ä¸Š</div>
                    <div id="week-sales" style="font-size: 28px; font-weight: 700; margin-bottom: 5px;">ï¿¥0</div>
                    <div id="week-count" style="font-size: 13px; opacity: 0.85;">0ä»¶</div>
                </div>
                <div style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); padding: 20px; border-radius: 10px; color: white; box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);">
                    <div style="font-size: 14px; opacity: 0.9; margin-bottom: 8px;">ğŸ“† ä»Šæœˆã®å£²ä¸Š</div>
                    <div id="month-sales" style="font-size: 28px; font-weight: 700; margin-bottom: 5px;">ï¿¥0</div>
                    <div id="month-count" style="font-size: 13px; opacity: 0.85;">0ä»¶</div>
                </div>
            </div>

            <button class="btn-export" onclick="exportToCSV()">ğŸ“¥ CSVå‡ºåŠ›</button>

            <div id="sales-list" class="sales-list">
                <!-- å£²ä¸Šãƒªã‚¹ãƒˆãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
            </div>
        </div>

        <!-- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚¿ãƒ– -->
        <div id="dashboard-tab" class="tab-content">
            <h2 style="margin-bottom: 25px; color: #667eea; font-size: 32px; font-weight: 700; text-align: center;">ğŸ“ˆ çµŒå–¶ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h2>
            
            <!-- v13.13: å¯¾è±¡æœŸé–“ï¼ˆé–‹å§‹å¹´æœˆã€œçµ‚äº†å¹´æœˆï¼‰ -->
            <div style="text-align: center; margin-bottom: 30px;">
                <div style="font-size: 14px; color: #999; margin-bottom: 8px; font-weight: 600;">å¯¾è±¡æœŸé–“</div>
                <div id="dashboard-period-display" style="font-size: 28px; font-weight: 700; color: #667eea; margin-bottom: 15px;">2025å¹´12æœˆ ã€œ 2025å¹´12æœˆ</div>
                <button onclick="toggleDashboardPeriodSelector()" id="dashboard-period-btn" style="padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 8px; font-size: 15px; font-weight: 600; cursor: pointer; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3); transition: all 0.3s;" onmouseover="this.style.background='#5568d3'" onmouseout="this.style.background='#667eea'">ğŸ“… æœŸé–“æŒ‡å®š</button>
            </div>
            
            <!-- Aæ¡ˆ: HTML5ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ‡ãƒ¼ãƒˆãƒ”ãƒƒã‚«ãƒ¼æ–¹å¼ -->
            <div id="dashboard-period-panel" style="display: none; max-width: 700px; margin: 0 auto 30px auto; padding: 30px; background: #f9fafb; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 25px;">
                    <!-- é–‹å§‹å¹´æœˆ -->
                    <div>
                        <label style="display: block; margin-bottom: 10px; color: #667eea; font-weight: 700; font-size: 16px;">ğŸ“… é–‹å§‹å¹´æœˆ</label>
                        <input type="month" id="dashboard-start-period" onchange="updateDashboardDisplay()" style="width: 100%; padding: 12px; border: 2px solid #667eea; border-radius: 8px; font-size: 18px; font-weight: 600; color: #667eea; cursor: pointer;" />
                    </div>
                    <!-- çµ‚äº†å¹´æœˆ -->
                    <div>
                        <label style="display: block; margin-bottom: 10px; color: #667eea; font-weight: 700; font-size: 16px;">ğŸ“… çµ‚äº†å¹´æœˆ</label>
                        <input type="month" id="dashboard-end-period" onchange="updateDashboardDisplay()" style="width: 100%; padding: 12px; border: 2px solid #667eea; border-radius: 8px; font-size: 18px; font-weight: 600; color: #667eea; cursor: pointer;" />
                    </div>
                </div>
                <div style="display: flex; gap: 15px; justify-content: center;">
                    <button onclick="applyDashboardPeriod()" style="padding: 14px 40px; background: #667eea; color: white; border: none; border-radius: 8px; font-size: 18px; font-weight: 700; cursor: pointer; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3); transition: all 0.3s;" onmouseover="this.style.background='#5568d3'" onmouseout="this.style.background='#667eea'">âœ… é©ç”¨</button>
                    <button onclick="toggleDashboardPeriodSelector()" style="padding: 14px 40px; background: #e5e7eb; color: #667eea; border: none; border-radius: 8px; font-size: 18px; font-weight: 700; cursor: pointer; transition: all 0.3s;" onmouseover="this.style.background='#d1d5db'" onmouseout="this.style.background='#e5e7eb'">âŒ ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                </div>
            </div>

            <!-- v13.13: 5ã¤ã®é‡è¦æŒ‡æ¨™ -->
            <div class="dashboard-grid" style="grid-template-columns: repeat(5, 1fr); gap: 15px;">
                <div class="dashboard-card">
                    <h3 style="font-size: 16px; margin-bottom: 10px;">ğŸ’° ç·å£²ä¸Š</h3>
                    <div class="value" id="total-sales" style="font-size: 26px;">Â¥0</div>
                </div>
                <div class="dashboard-card">
                    <h3 style="font-size: 16px; margin-bottom: 10px;">ğŸ“Š å–å¼•ä»¶æ•°</h3>
                    <div class="value" id="total-transactions" style="font-size: 26px;">0ä»¶</div>
                </div>
                <div class="dashboard-card">
                    <h3 style="font-size: 16px; margin-bottom: 10px;">ğŸ’µ å¹³å‡å–å¼•é¡</h3>
                    <div class="value" id="average-transaction" style="font-size: 26px;">Â¥0</div>
                </div>
                <div class="dashboard-card" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                    <h3 style="font-size: 16px; margin-bottom: 10px;">ğŸ‘¥ é¡§å®¢æ•°</h3>
                    <div class="value" id="customer-count" style="font-size: 26px;">0äºº</div>
                </div>
                <div class="dashboard-card" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                    <h3 style="font-size: 16px; margin-bottom: 10px;">ğŸ’³ å¹³å‡é¡§å®¢å˜ä¾¡</h3>
                    <div class="value" id="average-customer-spending" style="font-size: 26px;">Â¥0</div>
                </div>
            </div>

            <h3 style="margin: 30px 0 15px 0; color: #667eea; font-size: 18px;">ğŸ’³ æ±ºæ¸ˆæ–¹æ³•åˆ¥åˆ†æ</h3>
            
            <!-- v13.13: ãƒãƒˆãƒªãƒƒã‚¯ã‚¹è¡¨ã¨å††ã‚°ãƒ©ãƒ•ã®2åˆ—ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ -->
            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 30px; margin-bottom: 30px;">
                
                <!-- å·¦: ãƒãƒˆãƒªãƒƒã‚¯ã‚¹è¡¨ -->
                <div>
                    <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                        <thead>
                            <tr style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                                <th style="padding: 15px; text-align: left; font-size: 16px; font-weight: 700; width: 25%;">æ±ºæ¸ˆæ–¹æ³•</th>
                                <th style="padding: 15px; text-align: right; font-size: 16px; font-weight: 700; width: 35%;">å£²ä¸Šé«˜</th>
                                <th style="padding: 15px; text-align: right; font-size: 16px; font-weight: 700; width: 20%;">ä»¶æ•°</th>
                                <th style="padding: 15px; text-align: right; font-size: 16px; font-weight: 700; width: 20%;">æ§‹æˆæ¯”</th>
                            </tr>
                        </thead>
                        <tbody id="payment-matrix-body">
                            <!-- ãƒãƒˆãƒªãƒƒã‚¯ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«ã®è¡ŒãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
                        </tbody>
                    </table>
                </div>
                
                <!-- å³: å††ã‚°ãƒ©ãƒ• + å‡¡ä¾‹ -->
                <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                    <h4 style="margin: 0 0 15px 0; color: #667eea; font-size: 16px; font-weight: 700;">æ§‹æˆæ¯”</h4>
                    <canvas id="payment-pie-chart" width="250" height="250"></canvas>
                    <!-- å‡¡ä¾‹ -->
                    <div id="payment-legend" style="margin-top: 20px; width: 100%;">
                        <!-- å‡¡ä¾‹ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
                    </div>
                </div>
            </div>
            <!-- ãƒ©ãƒ³ã‚­ãƒ³ã‚°TOP10 å¤§è¦‹å‡ºã— -->
            <div style="margin: 40px 0 30px 0; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 15px; box-shadow: 0 8px 32px rgba(102, 126, 234, 0.3); text-align: center;">
                <h2 style="color: white; font-size: 28px; font-weight: 700; margin: 0; text-shadow: 2px 2px 4px rgba(0,0,0,0.2);">ğŸ† ãƒ©ãƒ³ã‚­ãƒ³ã‚° TOP 10</h2>
            </div>

            <!-- 2åˆ—ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ: ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥ & å•†å“åˆ¥ -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div>
                    <h3 style="margin: 0 0 15px 0; color: #667eea; font-size: 18px; font-weight: 700;">ğŸ† ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥å£²ä¸Š</h3>
                    <div class="ranking-list" id="category-ranking">
                        <!-- ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
                    </div>
                </div>
                <div>
                    <h3 style="margin: 0 0 15px 0; color: #667eea; font-size: 18px; font-weight: 700;">ğŸ† å•†å“åˆ¥å£²ä¸Š</h3>
                    <div class="ranking-list" id="product-ranking">
                        <!-- ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
                    </div>
                </div>
            </div>

            <h3 style="margin: 30px 0 15px 0; color: #667eea; font-size: 18px;">ğŸ† ãŠå®¢æ§˜åˆ¥å£²ä¸Š</h3>
            <div class="ranking-list" id="customer-ranking">
                <!-- ãŠå®¢æ§˜åˆ¥ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
            </div>

            <h3 style="margin: 30px 0 15px 0; color: #667eea; font-size: 18px;">ğŸ“… æ—¥åˆ¥å£²ä¸Š</h3>
            <div style="overflow-x: auto;">
                <table class="daily-sales-table" id="daily-sales-table">
                    <thead>
                        <tr>
                            <th>æ—¥ä»˜</th>
                            <th>å£²ä¸Š</th>
                            <th>ä»¶æ•°</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- æ—¥åˆ¥å£²ä¸ŠãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- è¨­å®šã‚¿ãƒ– -->
        <div id="settings-tab" class="tab-content">
            <h2 style="margin-bottom: 25px; color: #667eea; font-size: 22px;">âš™ï¸ ã‚·ã‚¹ãƒ†ãƒ è¨­å®š</h2>
            
            <!-- Google Sheetsé€£æºçŠ¶æ…‹ -->
            <div class="settings-section">
                <h3>ğŸ“Š Google Sheets é€£æºçŠ¶æ…‹</h3>
                <div class="settings-item">
                    <label>ğŸ”— GAS URL:</label>
                    <div class="value" id="gas-url-display">https://script.google.com/macros/s/AKfycbweT1picWkVBqRIp1L-2zVfBSidVOfjh7JppDMdERE7ghD7-5_jcpwz6DhlwV4WoUPJ/exec</div>
                </div>
                <div class="settings-item">
                    <label>ğŸ“ˆ é€£æºãƒ¢ãƒ¼ãƒ‰:</label>
                    <div class="value">CORSå¯¾å¿œç‰ˆ (no-cors mode)</div>
                </div>
                <div class="settings-item">
                    <label>ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ä¿å­˜å…ˆ:</label>
                    <div class="value">LocalStorage + Google Sheets (äºŒé‡ä¿å­˜)</div>
                </div>
                <button class="btn-settings btn-success" onclick="testGASConnection()">ğŸ”Œ æ¥ç¶šãƒ†ã‚¹ãƒˆ</button>
            </div>

            <!-- ãƒ‡ãƒ¼ã‚¿ç®¡ç† -->
            <div class="settings-section">
                <h3>ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ç®¡ç†</h3>
                <div class="settings-item">
                    <label>ğŸ“Š LocalStorage ãƒ‡ãƒ¼ã‚¿ä»¶æ•°:</label>
                    <div class="value" id="local-data-count">0ä»¶</div>
                </div>
                <button class="btn-settings" onclick="importToGoogleSheets()">â¬†ï¸ LocalStorageã‹ã‚‰Google Sheetsã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
                <button class="btn-settings btn-danger" onclick="deleteAllData()">ğŸ—‘ï¸ å…¨ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ (LocalStorage)</button>
            </div>

            <!-- ã‚·ã‚¹ãƒ†ãƒ æƒ…å ± -->
            <div class="settings-section">
                <h3>â„¹ï¸ ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±</h3>
                <div class="settings-item">
                    <label>ãƒãƒ¼ã‚¸ãƒ§ãƒ³:</label>
                    <div class="value">v13.13 (Phase 4-C: æ±ºæ¸ˆæ–¹æ³•åˆ¥åˆ†ææ”¹å–„ç‰ˆ)</div>
                </div>
                <div class="settings-item">
                    <label>æœ€çµ‚æ›´æ–°:</label>
                    <div class="value">2025å¹´12æœˆ7æ—¥</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // GAS URLï¼ˆv13.6ã§è¿½åŠ ï¼‰
        const GAS_URL = 'https://script.google.com/macros/s/AKfycbweT1picWkVBqRIp1L-2zVfBSidVOfjh7JppDMdERE7ghD7-5_jcpwz6DhlwV4WoUPJ/exec';
        
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        var salesData = [];
        var editingId = null;
        var itemCounter = 0;
        var currentSortKey = 'date';
        var currentSortOrder = 'desc';
        var listPeriodStart = null;
        var listPeriodEnd = null;
        var currentPeriodType = 'current-month';

        // v13.10 ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•ãƒ­ã‚°
        console.log('ğŸŒ¸ ã‚µãƒ­ãƒ³ Mode J å£²ä¸Šç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  v13.13 èµ·å‹• - Phase 4-C: æ±ºæ¸ˆæ–¹æ³•åˆ¥åˆ†ææ”¹å–„ç‰ˆ');
        console.log('ğŸ“Š Google Sheetsé€£æº: æœ‰åŠ¹ï¼ˆCORSå¯¾å¿œç‰ˆ - no-cors modeï¼‰');
        console.log('ğŸ”— GAS URL:', GAS_URL);

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†æ™‚ã®åˆæœŸåŒ–
        window.onload = function() {
            console.log('ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†');
            
            // LocalStorageã‹ã‚‰ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
            try {
                var stored = localStorage.getItem('salonSalesData');
                if (stored) {
                    salesData = JSON.parse(stored);
                    console.log('ğŸ“¦ LocalStorageã‹ã‚‰ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿:', salesData.length + 'ä»¶');
                } else {
                    console.log('ğŸ“­ LocalStorageã«ãƒ‡ãƒ¼ã‚¿ãªã—ï¼ˆåˆå›èµ·å‹•ï¼‰');
                }
            } catch (e) {
                console.error('ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', e);
                salesData = [];
            }
            
            // ä»Šæ—¥ã®æ—¥ä»˜ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«è¨­å®šï¼ˆv13.6.1ã§å¸¸ã«æ›´æ–°ï¼‰
            updateTodayDate();
            console.log('ğŸ“… ä»Šæ—¥ã®æ—¥ä»˜ã‚’è‡ªå‹•è¨­å®šå®Œäº†');
            
            // v13.6.5: ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’æ­£è¦åŒ–
            normalizeDataStructure();
            
            // æ±ºæ¸ˆæ–¹æ³•ã®é¸æŠ
            var paymentOptions = document.querySelectorAll('.payment-option');
            for (var i = 0; i < paymentOptions.length; i++) {
                paymentOptions[i].addEventListener('click', function() {
                    var allOptions = document.querySelectorAll('.payment-option');
                    for (var j = 0; j < allOptions.length; j++) {
                        allOptions[j].classList.remove('selected');
                    }
                    this.classList.add('selected');
                    document.getElementById('payment-method').value = this.getAttribute('data-value');
                });
            }

            // æ˜ç´°è¿½åŠ ãƒœã‚¿ãƒ³
            var addBtn = document.getElementById('add-item-btn');
            if (addBtn) {
                addBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    addItemRow();
                });
            }

            // ç™»éŒ²ãƒœã‚¿ãƒ³
            var submitBtn = document.getElementById('submit-btn');
            if (submitBtn) {
                submitBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    handleFormSubmit(e);
                });
            }

            // æ¤œç´¢æ©Ÿèƒ½
            document.getElementById('search-input').addEventListener('input', renderSalesList);

            // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ç”¨ã®æœŸé–“ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®åˆæœŸå€¤è¨­å®šï¼ˆv13.6.1ã§å¸¸ã«ä»Šæ—¥ï¼‰
            updateDashboardPeriod();

            // ä¸€è¦§ç”»é¢ç”¨ã®æœŸé–“ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®åˆæœŸå€¤è¨­å®šï¼ˆå½“æœˆï¼‰
            setPeriod('current-month');

            // åˆæœŸæ˜ç´°è¡Œã‚’1ã¤è¿½åŠ 
            addItemRow();

            // åˆæœŸè¡¨ç¤º
            updateSortIndicator();
            calculateDailyWeeklyMonthlySales();
            renderYearlyMonthlySales();
            renderMonthlyDailySales();
            renderSalesList();
            renderDashboard();
            updateLocalDataCount();
            
            console.log('âœ… ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å®Œäº†');
        };

        // ä»Šæ—¥ã®æ—¥ä»˜ã‚’æ›´æ–°ï¼ˆv13.6.1ã§è¿½åŠ ï¼‰
        function updateTodayDate() {
            var today = new Date();
            var todayString = formatDateISO(today); // v13.13: ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³å•é¡Œè§£æ±º
            document.getElementById('sale-date').value = todayString;
            console.log('ğŸ“… ä»Šæ—¥ã®æ—¥ä»˜ã‚’æ›´æ–°:', todayString);
        }

        // ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’æ­£è¦åŒ–ï¼ˆv13.6.5ã§è¿½åŠ ï¼‰
        function normalizeDataStructure() {
            console.log('ğŸ”„ ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’æ­£è¦åŒ–ä¸­...');
            var needsSave = false;
            
            for (var i = 0; i < salesData.length; i++) {
                var sale = salesData[i];
                
                // Google Sheetså½¢å¼ï¼ˆcustomer/productsï¼‰ã‚’v12.3å½¢å¼ï¼ˆcustomerName/itemsï¼‰ã«å¤‰æ›
                if (sale.customer && !sale.customerName) {
                    sale.customerName = sale.customer;
                    delete sale.customer;
                    needsSave = true;
                }
                
                if (sale.products && !sale.items) {
                    sale.items = sale.products.map(function(p) {
                        return {
                            category: p.category,
                            productName: p.product || p.productName,
                            quantity: p.quantity,
                            unitPrice: p.price || p.unitPrice,
                            subtotal: (p.price || p.unitPrice) * p.quantity
                        };
                    });
                    delete sale.products;
                    needsSave = true;
                }
                
                // v13.10: totalAmountã‚’æ•°å€¤å‹ã«å¤‰æ›
                if (typeof sale.totalAmount === 'string') {
                    sale.totalAmount = parseInt(sale.totalAmount) || 0;
                    needsSave = true;
                }
                if (typeof sale.totalAmount !== 'number' || isNaN(sale.totalAmount)) {
                    sale.totalAmount = 0;
                    needsSave = true;
                }
            }
            
            if (needsSave) {
                localStorage.setItem('salonSalesData', JSON.stringify(salesData));
                console.log('âœ… ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’æ­£è¦åŒ–ã—ã¾ã—ãŸ');
            } else {
                console.log('âœ… ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã¯æ—¢ã«æ­£è¦åŒ–ã•ã‚Œã¦ã„ã¾ã™');
            }
        }
        
        // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æœŸé–“ã‚’ä»Šæ—¥ã«æ›´æ–°ï¼ˆv13.6.1ã§è¿½åŠ ï¼‰
        function updateDashboardPeriod() {
            // v13.13: å¹´æœˆå˜ä½ã§æœŸé–“è¡¨ç¤ºã‚’æ›´æ–°
            var today = new Date();
            dashboardStartYear = today.getFullYear();
            dashboardStartMonth = today.getMonth() + 1;
            dashboardEndYear = today.getFullYear();
            dashboardEndMonth = today.getMonth() + 1;
            
            var displayElement = document.getElementById('dashboard-period-display');
            if (displayElement) {
                displayElement.textContent = dashboardStartYear + 'å¹´' + dashboardStartMonth + 'æœˆ ã€œ ' + dashboardEndYear + 'å¹´' + dashboardEndMonth + 'æœˆ';
            }
            
            // v13.13 Aæ¡ˆ: ãƒ‡ãƒ¼ãƒˆãƒ”ãƒƒã‚«ãƒ¼ã®åˆæœŸå€¤ã‚’è¨­å®š
            var startPeriod = dashboardStartYear + '-' + String(dashboardStartMonth).padStart(2, '0');
            var endPeriod = dashboardEndYear + '-' + String(dashboardEndMonth).padStart(2, '0');
            var startPicker = document.getElementById('dashboard-start-period');
            var endPicker = document.getElementById('dashboard-end-period');
            if (startPicker) startPicker.value = startPeriod;
            if (endPicker) endPicker.value = endPeriod;
            
            console.log('ğŸ“… ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æœŸé–“ã‚’ä»Šæœˆã«æ›´æ–°:', dashboardStartYear + 'å¹´' + dashboardStartMonth + 'æœˆ ã€œ ' + dashboardEndYear + 'å¹´' + dashboardEndMonth + 'æœˆ');
        }

        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
        function switchTab(tabName) {
            var tabs = document.querySelectorAll('.tab-content');
            var tabBtns = document.querySelectorAll('.tab-btn');
            
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }
            for (var i = 0; i < tabBtns.length; i++) {
                tabBtns[i].classList.remove('active');
            }
            
            if (tabName === 'input') {
                document.getElementById('input-tab').classList.add('active');
                tabBtns[0].classList.add('active');
                updateTodayDate(); // v13.6.1: å£²ä¸Šå…¥åŠ›ã‚¿ãƒ–ã§æ—¥ä»˜æ›´æ–°
            } else if (tabName === 'list') {
                document.getElementById('list-tab').classList.add('active');
                tabBtns[1].classList.add('active');
                calculateDailyWeeklyMonthlySales();
                renderYearlyMonthlySales(); // v13.6.1: å¸¸ã«ä»Šæ—¥ã®å¹´ã‚’è¡¨ç¤º
                renderMonthlyDailySales(); // v13.6.1: å¸¸ã«ä»Šæ—¥ã®æœˆã‚’è¡¨ç¤º
                renderSalesList();
            } else if (tabName === 'dashboard') {
                document.getElementById('dashboard-tab').classList.add('active');
                tabBtns[2].classList.add('active');
                updateDashboardPeriod(); // v13.6.1: ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§æœŸé–“ã‚’ä»Šæ—¥ã«æ›´æ–°
                renderDashboard();
            } else if (tabName === 'settings') {
                document.getElementById('settings-tab').classList.add('active');
                tabBtns[3].classList.add('active');
                updateLocalDataCount();
            }
        }

        // æ˜ç´°è¡Œã‚’è¿½åŠ 
        function addItemRow() {
            itemCounter++;
            var container = document.getElementById('items-container');
            var itemRow = document.createElement('div');
            itemRow.className = 'item-row';
            itemRow.id = 'item-row-' + itemCounter;
            
            itemRow.innerHTML = 
                '<div class="item-row-header">' +
                    '<span class="item-row-number">æ˜ç´° ' + itemCounter + '</span>' +
                    '<button type="button" class="btn-remove-item" data-row-id="' + itemCounter + '">ğŸ—‘ï¸ å‰Šé™¤</button>' +
                '</div>' +
                '<div class="form-group">' +
                    '<label>ã‚«ãƒ†ã‚´ãƒªãƒ¼ *</label>' +
                    '<select class="item-category" required>' +
                        '<option value="">é¸æŠã—ã¦ãã ã•ã„</option>' +
                        '<option value="ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³">ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³</option>' +
                        '<option value="ä¼šå“¡ è‹¥ã‚ˆã‚‚ãè’¸ã—">ä¼šå“¡ è‹¥ã‚ˆã‚‚ãè’¸ã—</option>' +
                        '<option value="éä¼šå“¡ è‹¥ã‚ˆã‚‚ãè’¸ã—">éä¼šå“¡ è‹¥ã‚ˆã‚‚ãè’¸ã—</option>' +
                        '<option value="æ–½è¡“">æ–½è¡“</option>' +
                        '<option value="ãƒ™ãƒ«ãƒãƒ³">ãƒ™ãƒ«ãƒãƒ³</option>' +
                        '<option value="ã‚¯ãƒ¬ãƒ³ã‚·ã‚¢">ã‚¯ãƒ¬ãƒ³ã‚·ã‚¢</option>' +
                        '<option value="æ°´ç´ é–¢é€£">æ°´ç´ é–¢é€£</option>' +
                        '<option value="ãã®ä»–">ãã®ä»–</option>' +
                    '</select>' +
                '</div>' +
                '<div class="form-group">' +
                    '<label>å•†å“å *</label>' +
                    '<input type="text" class="item-product-name" placeholder="å•†å“åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„" required>' +
                '</div>' +
                '<div class="item-grid">' +
                    '<div class="form-group">' +
                        '<label>å€‹æ•° *</label>' +
                        '<input type="number" class="item-quantity" min="1" value="1" required>' +
                    '</div>' +
                    '<div class="form-group">' +
                        '<label>å˜ä¾¡ *</label>' +
                        '<input type="number" class="item-unit-price" min="0" required>' +
                    '</div>' +
                    '<div class="form-group">' +
                        '<label>å°è¨ˆ</label>' +
                        '<input type="number" class="item-subtotal" readonly style="background: #f0f0f0;">' +
                    '</div>' +
                '</div>';
            
            container.appendChild(itemRow);
            
            // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¿½åŠ 
            var removeBtn = itemRow.querySelector('.btn-remove-item');
            removeBtn.addEventListener('click', function() {
                removeItemRow(this.getAttribute('data-row-id'));
            });
            
            var quantityInput = itemRow.querySelector('.item-quantity');
            var priceInput = itemRow.querySelector('.item-unit-price');
            var subtotalInput = itemRow.querySelector('.item-subtotal');
            
            function updateSubtotal() {
                var quantity = parseInt(quantityInput.value) || 0;
                var price = parseInt(priceInput.value) || 0;
                var subtotal = quantity * price;
                subtotalInput.value = subtotal;
                updateGrandTotal();
            }
            
            quantityInput.addEventListener('input', updateSubtotal);
            priceInput.addEventListener('input', updateSubtotal);
        }

        // æ˜ç´°è¡Œã‚’å‰Šé™¤
        function removeItemRow(rowId) {
            var itemRows = document.querySelectorAll('.item-row');
            if (itemRows.length <= 1) {
                showNotification('æœ€ä½1ã¤ã®æ˜ç´°ãŒå¿…è¦ã§ã™', 'error');
                return;
            }
            var row = document.getElementById('item-row-' + rowId);
            if (row) {
                row.remove();
                updateGrandTotal();
            }
        }

        // åˆè¨ˆé‡‘é¡ã‚’æ›´æ–°
        function updateGrandTotal() {
            var subtotals = document.querySelectorAll('.item-subtotal');
            var total = 0;
            for (var i = 0; i < subtotals.length; i++) {
                total += parseInt(subtotals[i].value) || 0;
            }
            document.getElementById('grand-total').textContent = 'Â¥' + total.toLocaleString();
        }

        // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡å‡¦ç†
        function handleFormSubmit(e) {
            console.log('ğŸ“ å£²ä¸Šç™»éŒ²å‡¦ç†é–‹å§‹...');
            e.preventDefault();
            
            var saleDate = document.getElementById('sale-date').value;
            var customerName = document.getElementById('customer-name').value.trim();
            var paymentMethod = document.getElementById('payment-method').value;
            
            if (!saleDate || !customerName || !paymentMethod) {
                showNotification('å¿…é ˆé …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
                return;
            }
            
            var itemRows = document.querySelectorAll('.item-row');
            var items = [];
            var totalAmount = 0;
            
            for (var i = 0; i < itemRows.length; i++) {
                var category = itemRows[i].querySelector('.item-category').value;
                var productName = itemRows[i].querySelector('.item-product-name').value.trim();
                var quantity = parseInt(itemRows[i].querySelector('.item-quantity').value);
                var unitPrice = parseInt(itemRows[i].querySelector('.item-unit-price').value);
                var subtotal = parseInt(itemRows[i].querySelector('.item-subtotal').value);
                
                if (!category || !productName || !quantity || !unitPrice) {
                    showNotification('å…¨ã¦ã®æ˜ç´°é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
                    return;
                }
                
                items.push({
                    category: category,
                    productName: productName,
                    quantity: quantity,
                    unitPrice: unitPrice,
                    subtotal: subtotal
                });
                
                totalAmount += subtotal;
            }
            
            var saleData = {
                id: editingId || Date.now(),
                date: saleDate,
                customerName: customerName,
                items: items,
                totalAmount: totalAmount,
                paymentMethod: paymentMethod
            };
            
            console.log('ğŸ“Š ç™»éŒ²ãƒ‡ãƒ¼ã‚¿:', saleData);
            
            if (editingId) {
                var index = salesData.findIndex(function(item) { return item.id === editingId; });
                if (index !== -1) {
                    salesData[index] = saleData;
                }
                editingId = null;
            } else {
                salesData.push(saleData);
            }
            
            // LocalStorageã«ä¿å­˜
            localStorage.setItem('salonSalesData', JSON.stringify(salesData));
            console.log('ğŸ’¾ LocalStorageã«ä¿å­˜:', salesData.length + 'ä»¶');
            
            // Google Sheetsã«é€ä¿¡ï¼ˆv13.6ã§è¿½åŠ ï¼‰
            sendToGoogleSheets(saleData);
            
            showNotification('âœ… å£²ä¸Šã‚’ç™»éŒ²ã—ã¾ã—ãŸï¼ˆGoogle Sheetsã«é€ä¿¡æ¸ˆã¿ï¼‰');
            resetForm();
            renderSalesList();
            renderDashboard();
            calculateDailyWeeklyMonthlySales();
            renderYearlyMonthlySales();
            renderMonthlyDailySales();
        }

        // Google Sheetsã«ãƒ‡ãƒ¼ã‚¿é€ä¿¡ï¼ˆv13.6ã§è¿½åŠ ï¼‰
        function sendToGoogleSheets(saleData) {
            console.log('ğŸ“¤ Google Sheetsã¸ãƒ‡ãƒ¼ã‚¿é€ä¿¡é–‹å§‹...');
            console.log('ğŸ”— é€ä¿¡å…ˆURL:', GAS_URL);
            
            // v13.7: customerName, items ã«çµ±ä¸€
            var postData = {
                action: 'saveSale',
                data: {
                    id: String(saleData.id),
                    date: saleData.date,
                    customerName: saleData.customerName,
                    items: saleData.items,
                    totalAmount: saleData.totalAmount,
                    paymentMethod: saleData.paymentMethod,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                }
            };
            
            fetch(GAS_URL, {
                method: 'POST',
                mode: 'no-cors', // CORSå¯¾å¿œ
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(postData)
            })
            .then(function() {
                console.log('âœ… Google Sheetsé€ä¿¡å®Œäº†ï¼ˆno-cors modeï¼‰');
            })
            .catch(function(error) {
                console.error('âŒ Google Sheetsé€ä¿¡ã‚¨ãƒ©ãƒ¼:', error);
            });
        }

        // ãƒ•ã‚©ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ
        function resetForm() {
            document.getElementById('sales-form').reset();
            updateTodayDate(); // v13.6.1: ãƒ•ã‚©ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆæ™‚ã«ä»Šæ—¥ã®æ—¥ä»˜ã‚’è¨­å®š
            
            var paymentOptions = document.querySelectorAll('.payment-option');
            for (var i = 0; i < paymentOptions.length; i++) {
                paymentOptions[i].classList.remove('selected');
            }
            
            var container = document.getElementById('items-container');
            container.innerHTML = '';
            itemCounter = 0;
            addItemRow();
            updateGrandTotal();
        }

        // v13.9: æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆé–¢æ•°ï¼ˆYYYYå¹´MMæœˆDDæ—¥å½¢å¼ï¼‰
        function formatDate(date) {
            var year = date.getFullYear();
            var month = date.getMonth() + 1;
            var day = date.getDate();
            return year + 'å¹´' + month + 'æœˆ' + day + 'æ—¥';
        }
        
        // v13.13: æ—¥ä»˜ã‚’YYYY-MM-DDå½¢å¼ã«å¤‰æ›ï¼ˆã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³å•é¡Œè§£æ±ºï¼‰
        function formatDateISO(date) {
            var year = date.getFullYear();
            var month = String(date.getMonth() + 1).padStart(2, '0');
            var day = String(date.getDate()).padStart(2, '0');
            return year + '-' + month + '-' + day;
        }

        // é€šçŸ¥è¡¨ç¤º
        function showNotification(message, type) {
            var notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            if (type === 'error') {
                notification.style.background = '#ef4444';
            }
            document.body.appendChild(notification);
            
            setTimeout(function() {
                notification.remove();
            }, 3000);
        }

        // æœŸé–“è¨­å®šï¼ˆv13.9ã§å¤§å¹…æ”¹å–„ï¼‰
        function setPeriod(periodType, event) {
            console.log('ğŸ“… setPeriodå‘¼ã³å‡ºã—:', periodType);
            currentPeriodType = periodType;
            var today = new Date();
            var start, end;
            var displayText = '';
            
            if (periodType === 'today') {
                start = end = today;
                displayText = 'æœ¬æ—¥ (' + formatDate(today) + ')';
            } else if (periodType === 'this-week') {
                // v13.9: æ—¥æ›œæ—¥é–‹å§‹ã€åœŸæ›œæ—¥çµ‚äº†
                var dayOfWeek = today.getDay(); // 0(æ—¥)ã€œ6(åœŸ)
                start = new Date(today);
                start.setDate(today.getDate() - dayOfWeek); // ä»Šé€±ã®æ—¥æ›œæ—¥
                end = new Date(start);
                end.setDate(start.getDate() + 6); // ä»Šé€±ã®åœŸæ›œæ—¥
                displayText = 'ä»Šé€± (' + formatDate(start) + ' ã€œ ' + formatDate(end) + ')';
            } else if (periodType === 'current-month') {
                // v13.9: 1æ—¥å§‹ã¾ã‚Šã€æœˆæœ«æ—¥çµ‚ã‚ã‚Šï¼ˆã†ã‚‹ã†å¹´å¯¾å¿œï¼‰
                start = new Date(today.getFullYear(), today.getMonth(), 1);
                end = new Date(today.getFullYear(), today.getMonth() + 1, 0); // æ­£ã—ã„æœˆæœ«æ—¥
                displayText = 'ä»Šæœˆ (' + formatDate(start) + ' ã€œ ' + formatDate(end) + ')';
            } else if (periodType === 'last-month') {
                // v13.9: 1æ—¥å§‹ã¾ã‚Šã€æœˆæœ«æ—¥çµ‚ã‚ã‚Šï¼ˆã†ã‚‹ã†å¹´å¯¾å¿œï¼‰
                start = new Date(today.getFullYear(), today.getMonth() - 1, 1);
                end = new Date(today.getFullYear(), today.getMonth(), 0); // å…ˆæœˆã®æœˆæœ«æ—¥
                displayText = 'å…ˆæœˆ (' + formatDate(start) + ' ã€œ ' + formatDate(end) + ')';
            } else if (periodType === '2months-ago') {
                // v13.9: 1æ—¥å§‹ã¾ã‚Šã€æœˆæœ«æ—¥çµ‚ã‚ã‚Šï¼ˆã†ã‚‹ã†å¹´å¯¾å¿œï¼‰
                start = new Date(today.getFullYear(), today.getMonth() - 2, 1);
                end = new Date(today.getFullYear(), today.getMonth() - 1, 0); // å…ˆã€…æœˆã®æœˆæœ«æ—¥
                displayText = 'å…ˆã€…æœˆ (' + formatDate(start) + ' ã€œ ' + formatDate(end) + ')';
            }
            
            // v13.13: ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³å•é¡Œè§£æ±º - toISOString()ã®ä»£ã‚ã‚Šã«formatDateISO()ã‚’ä½¿ç”¨
            listPeriodStart = formatDateISO(start);
            listPeriodEnd = formatDateISO(end);
            
            console.log('ğŸ“… æœŸé–“è¨­å®šå®Œäº†:', listPeriodStart, '~', listPeriodEnd);
            
            document.getElementById('list-period-start').value = listPeriodStart;
            document.getElementById('list-period-end').value = listPeriodEnd;
            
            // v13.9: è©³ç´°ãªæ—¥ä»˜è¡¨ç¤º
            document.getElementById('current-period-display').textContent = 'ç¾åœ¨ã®è¡¨ç¤º: ' + displayText;
            
            var buttons = document.querySelectorAll('.btn-period');
            for (var i = 0; i < buttons.length; i++) {
                buttons[i].classList.remove('active');
                buttons[i].style.background = 'white';
                buttons[i].style.color = '#667eea';
            }
            
            // v13.6.2: eventãŒå­˜åœ¨ã™ã‚‹å ´åˆã®ã¿ãƒœã‚¿ãƒ³ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
            if (event && event.target) {
                event.target.classList.add('active');
                event.target.style.background = '#667eea';
                event.target.style.color = 'white';
            } else {
                // åˆæœŸåŒ–æ™‚ã¯current-monthãƒœã‚¿ãƒ³ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
                var currentMonthBtn = document.getElementById('period-current-month');
                if (currentMonthBtn) {
                    currentMonthBtn.classList.add('active');
                    currentMonthBtn.style.background = '#667eea';
                    currentMonthBtn.style.color = 'white';
                }
            }
            
            calculateDailyWeeklyMonthlySales();
            renderYearlyMonthlySales();
            renderMonthlyDailySales();
            renderSalesList();
        }

        // ä»»æ„æœŸé–“é©ç”¨ï¼ˆv13.10: è¡¨ç¤ºå½¢å¼çµ±ä¸€ï¼‰
        function applyCustomPeriod() {
            listPeriodStart = document.getElementById('list-period-start').value;
            listPeriodEnd = document.getElementById('list-period-end').value;
            
            if (!listPeriodStart || !listPeriodEnd) {
                showNotification('é–‹å§‹æ—¥ã¨çµ‚äº†æ—¥ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
                return;
            }
            
            // v13.10: è¡¨ç¤ºå½¢å¼ã‚’ä»–ã®ãƒœã‚¿ãƒ³ã¨çµ±ä¸€ï¼ˆYYYYå¹´MMæœˆDDæ—¥å½¢å¼ï¼‰
            var startDate = new Date(listPeriodStart);
            var endDate = new Date(listPeriodEnd);
            var displayText = 'ä»»æ„æœŸé–“ (' + formatDate(startDate) + ' ã€œ ' + formatDate(endDate) + ')';
            
            document.getElementById('current-period-display').textContent = 'ç¾åœ¨ã®è¡¨ç¤º: ' + displayText;
            
            // v13.10: currentPeriodTypeã‚’è¨­å®šï¼ˆæœˆé–“æ—¥æ¬¡å£²ä¸Šæ¨ç§»ã®è¡¨ç¤ºã«å¿…è¦ï¼‰
            currentPeriodType = 'custom';
            
            var buttons = document.querySelectorAll('.btn-period');
            for (var i = 0; i < buttons.length; i++) {
                buttons[i].classList.remove('active');
                buttons[i].style.background = 'white';
                buttons[i].style.color = '#667eea';
            }
            
            calculateDailyWeeklyMonthlySales();
            renderYearlyMonthlySales();
            renderMonthlyDailySales();
            renderSalesList();
        }

        // æœŸé–“ãƒªã‚»ãƒƒãƒˆ
        function resetListPeriod() {
            setPeriod('current-month');
        }

        // ã‚½ãƒ¼ãƒˆ
        function sortSales(sortKey) {
            if (currentSortKey === sortKey) {
                currentSortOrder = currentSortOrder === 'asc' ? 'desc' : 'asc';
            } else {
                currentSortKey = sortKey;
                currentSortOrder = 'desc';
            }
            updateSortIndicator();
            renderSalesList();
        }

        // ã‚½ãƒ¼ãƒˆè¡¨ç¤ºæ›´æ–°ï¼ˆv13.10: sort-indicatorè¦ç´ ãŒãªã„å ´åˆã®ã‚¨ãƒ©ãƒ¼é˜²æ­¢ï¼‰
        function updateSortIndicator() {
            var indicator = document.getElementById('sort-indicator');
            if (!indicator) {
                console.log('ã‚½ãƒ¼ãƒˆæ›´æ–°:', currentSortKey, currentSortOrder);
                return;
            }
            var labels = {
                'date': 'æ—¥ä»˜',
                'customer': 'ãŠå®¢æ§˜å',
                'payment': 'æ±ºæ¸ˆæ–¹æ³•',
                'amount': 'é‡‘é¡'
            };
            var orderLabel = currentSortOrder === 'asc' ? 'æ˜‡é † â†‘' : 'é™é † â†“';
            indicator.textContent = labels[currentSortKey] + ' ' + orderLabel;
        }

        // æ—¥æ¬¡ãƒ»é€±æ¬¡ãƒ»æœˆæ¬¡é›†è¨ˆ
        function calculateDailyWeeklyMonthlySales() {
            var today = new Date();
            var todayStr = formatDateISO(today); // v13.13: ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³å•é¡Œè§£æ±º
            
            var todaySales = 0, todayCount = 0;
            var weekSales = 0, weekCount = 0;
            var monthSales = 0, monthCount = 0;
            
            var dayOfWeek = today.getDay();
            var weekStart = new Date(today);
            weekStart.setDate(today.getDate() - dayOfWeek);
            var weekStartStr = formatDateISO(weekStart); // v13.13: ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³å•é¡Œè§£æ±º
            
            var monthStart = new Date(today.getFullYear(), today.getMonth(), 1);
            var monthStartStr = formatDateISO(monthStart); // v13.13: ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³å•é¡Œè§£æ±º
            
            // v13.13: å–å¼•ä»¶æ•° = æ˜ç´°ï¼ˆitemsï¼‰ã®åˆè¨ˆæ•°
            for (var i = 0; i < salesData.length; i++) {
                var sale = salesData[i];
                var itemCount = (sale.items && sale.items.length > 0) ? sale.items.length : 0;
                
                if (sale.date === todayStr) {
                    todaySales += sale.totalAmount;
                    todayCount += itemCount;
                }
                if (sale.date >= weekStartStr && sale.date <= todayStr) {
                    weekSales += sale.totalAmount;
                    weekCount += itemCount;
                }
                if (sale.date >= monthStartStr && sale.date <= todayStr) {
                    monthSales += sale.totalAmount;
                    monthCount += itemCount;
                }
            }
            
            document.getElementById('today-sales').textContent = 'ï¿¥' + todaySales.toLocaleString();
            document.getElementById('today-count').textContent = todayCount + 'ä»¶';
            document.getElementById('week-sales').textContent = 'ï¿¥' + weekSales.toLocaleString();
            document.getElementById('week-count').textContent = weekCount + 'ä»¶';
            document.getElementById('month-sales').textContent = 'ï¿¥' + monthSales.toLocaleString();
            document.getElementById('month-count').textContent = monthCount + 'ä»¶';
        }

        // å¹´é–“æœˆæ¬¡å£²ä¸Šæ¨ç§»
        // å¹´é–“æœˆæ¬¡å£²ä¸Šæ¨ç§»: ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        var selectedDisplayYear = new Date().getFullYear();
        
        function renderYearlyMonthlySales() {
            // å¹´åº¦ã‚»ãƒ¬ã‚¯ã‚¿ã‚’ç”Ÿæˆ
            var yearSelector = document.getElementById('yearly-year-selector');
            var availableYears = {};
            
            for (var i = 0; i < salesData.length; i++) {
                var saleYear = new Date(salesData[i].date).getFullYear();
                availableYears[saleYear] = true;
            }
            
            var yearsArray = Object.keys(availableYears).map(Number).sort(function(a, b) { return b - a; });
            if (yearsArray.length === 0) {
                yearsArray = [new Date().getFullYear()];
            }
            
            // selectedDisplayYearãŒæœ‰åŠ¹ãªå¹´ã§ãªã‘ã‚Œã°ã€æœ€åˆã®å¹´ã«è¨­å®š
            if (yearsArray.indexOf(selectedDisplayYear) === -1) {
                selectedDisplayYear = yearsArray[0];
            }
            
            yearSelector.innerHTML = '';
            for (var i = 0; i < yearsArray.length; i++) {
                var option = document.createElement('option');
                option.value = yearsArray[i];
                option.textContent = yearsArray[i] + 'å¹´';
                option.selected = yearsArray[i] === selectedDisplayYear;
                yearSelector.appendChild(option);
            }
            
            // æœˆæ¬¡ãƒ‡ãƒ¼ã‚¿é›†è¨ˆ
            var monthlyData = {};
            for (var i = 1; i <= 12; i++) {
                monthlyData[i] = { sales: 0, count: 0 };
            }
            
            for (var i = 0; i < salesData.length; i++) {
                var sale = salesData[i];
                var saleDate = new Date(sale.date);
                if (saleDate.getFullYear() === selectedDisplayYear) {
                    var month = saleDate.getMonth() + 1;
                    monthlyData[month].sales += sale.totalAmount;
                    monthlyData[month].count++;
                }
            }
            
            var maxSales = 0;
            for (var month in monthlyData) {
                if (monthlyData[month].sales > maxSales) {
                    maxSales = monthlyData[month].sales;
                }
            }
            
            var chartContainer = document.getElementById('yearly-monthly-chart');
            chartContainer.innerHTML = '';
            
            var yearlyTotal = 0;
            for (var month = 1; month <= 12; month++) {
                var data = monthlyData[month];
                yearlyTotal += data.sales;
                
                // v13.10: ã‚°ãƒ©ãƒ•è¡¨ç¤ºã‚’ä¿®æ­£ï¼ˆå£²ä¸Šé‡‘é¡è¡¨ç¤ºè¿½åŠ ï¼‰
                var monthDiv = document.createElement('div');
                monthDiv.style.cssText = 'display: flex; flex-direction: column; align-items: center; height: 220px; justify-content: flex-end;';
                
                // å£²ä¸Šé‡‘é¡ãƒ©ãƒ™ãƒ«ï¼ˆ,000å½¢å¼ã€è€çœ¼å¯¾å¿œï¼‰
                var amountLabel = document.createElement('div');
                if (data.sales > 0) {
                    amountLabel.textContent = 'Â¥' + data.sales.toLocaleString();
                    amountLabel.style.cssText = 'font-size: 15px; font-weight: 700; color: #667eea; margin-bottom: 5px; height: 20px; line-height: 1.2;';
                } else {
                    amountLabel.style.cssText = 'height: 20px;';
                }
                
                var barHeight = maxSales > 0 ? (data.sales / maxSales * 150) : 0;
                var bar = document.createElement('div');
                bar.style.cssText = 
                    'width: 100%; height: ' + barHeight + 'px; background: linear-gradient(180deg, #667eea 0%, #764ba2 100%); ' +
                    'border-radius: 4px 4px 0 0; transition: all 0.3s; cursor: pointer;';
                bar.title = month + 'æœˆ: Â¥' + data.sales.toLocaleString() + ' (' + data.count + 'ä»¶)';
                
                var monthLabel = document.createElement('div');
                monthLabel.textContent = month + 'æœˆ';
                monthLabel.style.cssText = 'font-size: 12px; font-weight: 600; color: #667eea; margin-top: 5px; height: 20px;';
                
                monthDiv.appendChild(amountLabel);
                monthDiv.appendChild(bar);
                monthDiv.appendChild(monthLabel);
                chartContainer.appendChild(monthDiv);
            }
            
            document.getElementById('yearly-total').textContent = 'Â¥' + yearlyTotal.toLocaleString();
        }
        
        // å¹´åº¦é¸æŠå¤‰æ›´
        function changeYearDisplay() {
            selectedDisplayYear = parseInt(document.getElementById('yearly-year-selector').value);
            renderYearlyMonthlySales();
        }

        // æœˆé–“æ—¥æ¬¡å£²ä¸Šæ¨ç§»ï¼ˆv13.10: æœŸé–“ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é€£å‹•ï¼‰
        function renderMonthlyDailySales() {
            var displayYear, displayMonth;
            
            // v13.10: æœŸé–“ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã«å¿œã˜ã¦è¡¨ç¤ºæœˆã‚’æ±ºå®š
            if (currentPeriodType === 'today' || currentPeriodType === 'this-week') {
                // ã€Œæœ¬æ—¥ã€ã€Œä»Šé€±ã€â†’ å½“æœˆã‚’è¡¨ç¤º
                var today = new Date();
                displayYear = today.getFullYear();
                displayMonth = today.getMonth();
            } else if (currentPeriodType === 'current-month') {
                // ã€Œä»Šæœˆã€â†’ ä»Šæœˆã‚’è¡¨ç¤º
                var today = new Date();
                displayYear = today.getFullYear();
                displayMonth = today.getMonth();
            } else if (currentPeriodType === 'last-month') {
                // ã€Œå…ˆæœˆã€â†’ å…ˆæœˆã‚’è¡¨ç¤º
                var today = new Date();
                displayYear = today.getFullYear();
                displayMonth = today.getMonth() - 1;
                if (displayMonth < 0) {
                    displayMonth = 11;
                    displayYear--;
                }
            } else if (currentPeriodType === '2months-ago') {
                // ã€Œå…ˆã€…æœˆã€â†’ å…ˆã€…æœˆã‚’è¡¨ç¤º
                var today = new Date();
                displayYear = today.getFullYear();
                displayMonth = today.getMonth() - 2;
                if (displayMonth < 0) {
                    displayMonth += 12;
                    displayYear--;
                }
            } else if (listPeriodStart && listPeriodEnd) {
                // ã€Œä»»æ„æœŸé–“ã€â†’ é–‹å§‹ãƒ»çµ‚äº†ã®å¹´æœˆãŒåŒã˜ãªã‚‰è©²å½“æœˆã€ç•°ãªã‚‹ãªã‚‰é–‹å§‹æœˆ
                var startDate = new Date(listPeriodStart);
                var endDate = new Date(listPeriodEnd);
                displayYear = startDate.getFullYear();
                displayMonth = startDate.getMonth();
                
                // å¹´æœˆãŒç•°ãªã‚‹å ´åˆã‚‚é–‹å§‹æœˆã‚’è¡¨ç¤ºï¼ˆè¦æœ›é€šã‚Šï¼‰
            } else {
                // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: å½“æœˆ
                var today = new Date();
                displayYear = today.getFullYear();
                displayMonth = today.getMonth();
            }
            
            document.getElementById('monthly-display-period').textContent = 
                '(' + displayYear + 'å¹´' + (displayMonth + 1) + 'æœˆ)';
            
            var year = displayYear;
            var month = displayMonth;
            
            var daysInMonth = new Date(year, month + 1, 0).getDate();
            var firstDayOfWeek = new Date(year, month, 1).getDay();
            
            var dailyData = {};
            for (var day = 1; day <= daysInMonth; day++) {
                dailyData[day] = { sales: 0, count: 0 };
            }
            
            for (var i = 0; i < salesData.length; i++) {
                var sale = salesData[i];
                var saleDate = new Date(sale.date);
                if (saleDate.getFullYear() === year && saleDate.getMonth() === month) {
                    var day = saleDate.getDate();
                    dailyData[day].sales += sale.totalAmount;
                    dailyData[day].count++;
                }
            }
            
            var maxSales = 0;
            for (var day in dailyData) {
                if (dailyData[day].sales > maxSales) {
                    maxSales = dailyData[day].sales;
                }
            }
            
            var chartContainer = document.getElementById('monthly-daily-chart');
            chartContainer.innerHTML = '';
            
            // ç©ºç™½ã‚»ãƒ«è¿½åŠ 
            for (var i = 0; i < firstDayOfWeek; i++) {
                var emptyDiv = document.createElement('div');
                chartContainer.appendChild(emptyDiv);
            }
            
            var monthlyTotal = 0;
            var monthlyCount = 0;
            
            for (var day = 1; day <= daysInMonth; day++) {
                var data = dailyData[day];
                monthlyTotal += data.sales;
                monthlyCount += data.count;
                
                var dayDiv = document.createElement('div');
                var intensity = maxSales > 0 ? (data.sales / maxSales) : 0;
                var bgColor = intensity > 0.7 ? '#667eea' : intensity > 0.4 ? '#9f7aea' : intensity > 0 ? '#d6bcfa' : '#f3f4f6';
                
                dayDiv.style.cssText = 
                    'padding: 12px 8px; background: ' + bgColor + '; border-radius: 6px; text-align: center; ' +
                    'cursor: pointer; transition: all 0.3s; font-size: 12px; font-weight: 600; ' +
                    'min-height: 70px; display: flex; flex-direction: column; justify-content: center; ' +
                    'color: ' + (intensity > 0.4 ? 'white' : '#667eea') + ';';
                // v13.10: é‡‘é¡è¡¨ç¤ºã‚’å¤§ããã€,000å½¢å¼ã€è€çœ¼å¯¾å¿œ
                var displayAmount = data.sales > 0 ? 'Â¥' + data.sales.toLocaleString() : 'Â¥0';
                dayDiv.innerHTML = 
                    '<div style="font-size: 18px; margin-bottom: 6px; font-weight: 700;">' + day + '</div>' +
                    '<div style="font-size: 14px; opacity: 1; font-weight: 700; line-height: 1.3;">' + displayAmount + '</div>';
                dayDiv.title = day + 'æ—¥: Â¥' + data.sales.toLocaleString() + ' (' + data.count + 'ä»¶)';
                
                chartContainer.appendChild(dayDiv);
            }
            
            document.getElementById('monthly-total').textContent = 'Â¥' + monthlyTotal.toLocaleString();
            document.getElementById('monthly-count').textContent = monthlyCount;
        }

        // å£²ä¸Šä¸€è¦§è¡¨ç¤º
        function renderSalesList() {
            var searchQuery = document.getElementById('search-input').value.toLowerCase();
            
            // v13.10: æœŸé–“ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®ä¿®æ­£ï¼ˆæ–‡å­—åˆ—æ¯”è¼ƒã®å•é¡Œè§£æ±ºï¼‰
            var filteredData = salesData.filter(function(sale) {
                // æœŸé–“ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆæ—¥ä»˜æ–‡å­—åˆ—æ¯”è¼ƒï¼‰
                if (listPeriodStart && sale.date < listPeriodStart) {
                    return false;
                }
                if (listPeriodEnd && sale.date > listPeriodEnd) {
                    return false;
                }
                
                // æ¤œç´¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
                if (searchQuery) {
                    var customerMatch = sale.customerName && sale.customerName.toLowerCase().includes(searchQuery);
                    var itemsMatch = sale.items && sale.items.some(function(item) {
                        return (item.category && item.category.toLowerCase().includes(searchQuery)) ||
                               (item.productName && item.productName.toLowerCase().includes(searchQuery));
                    });
                    return customerMatch || itemsMatch;
                }
                
                return true;
            });
            
            console.log('ğŸ“‹ å£²ä¸Šãƒªã‚¹ãƒˆãƒ•ã‚£ãƒ«ã‚¿ãƒ¼:', 'å…¨' + salesData.length + 'ä»¶ â†’ è¡¨ç¤º' + filteredData.length + 'ä»¶', '(æœŸé–“: ' + listPeriodStart + ' ~ ' + listPeriodEnd + ')');
            
            // ã‚½ãƒ¼ãƒˆ
            filteredData.sort(function(a, b) {
                var aVal, bVal;
                if (currentSortKey === 'date') {
                    aVal = a.date;
                    bVal = b.date;
                } else if (currentSortKey === 'customer') {
                    aVal = a.customerName;
                    bVal = b.customerName;
                } else if (currentSortKey === 'payment') {
                    aVal = a.paymentMethod;
                    bVal = b.paymentMethod;
                } else if (currentSortKey === 'amount') {
                    aVal = a.totalAmount;
                    bVal = b.totalAmount;
                }
                
                if (currentSortOrder === 'asc') {
                    return aVal > bVal ? 1 : -1;
                } else {
                    return aVal < bVal ? 1 : -1;
                }
            });
            
            var listContainer = document.getElementById('sales-list');
            
            if (filteredData.length === 0) {
                listContainer.innerHTML = '<div class="empty-state">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>';
                return;
            }
            
            // v13.10: ãƒ˜ãƒƒãƒ€ãƒ¼ã«ã‚½ãƒ¼ãƒˆæ©Ÿèƒ½ã‚’è¿½åŠ 
            var sortIcon = function(key) {
                if (currentSortKey === key) {
                    return currentSortOrder === 'asc' ? ' â–²' : ' â–¼';
                }
                return '';
            };
            
            var tableHTML = '<table class="sales-table"><thead><tr>' +
                '<th style="cursor: pointer;" onclick="sortSales(\'date\')">ğŸ“… æ—¥ä»˜' + sortIcon('date') + '</th>' +
                '<th style="cursor: pointer;" onclick="sortSales(\'customer\')">ğŸ‘¤ ãŠå®¢æ§˜å' + sortIcon('customer') + '</th>' +
                '<th style="cursor: pointer;" onclick="sortSales(\'amount\')">ğŸ’° é‡‘é¡' + sortIcon('amount') + '</th>' +
                '<th style="cursor: pointer;" onclick="sortSales(\'payment\')">ğŸ’³ æ±ºæ¸ˆæ–¹æ³•' + sortIcon('payment') + '</th>' +
                '<th>æ“ä½œ</th>' +
                '</tr></thead><tbody>';
            
            for (var i = 0; i < filteredData.length; i++) {
                var sale = filteredData[i];
                var paymentIcon = sale.paymentMethod === 'ç¾é‡‘' ? 'ğŸ’µ' : 
                                 sale.paymentMethod === 'æŒ¯è¾¼' ? 'ğŸ¦' : 'ğŸ’³';
                
                tableHTML += '<tr>' +
                    '<td class="sales-table-date">' + sale.date + '</td>' +
                    '<td>' + sale.customerName + '</td>' +
                    '<td class="sales-table-amount">Â¥' + sale.totalAmount.toLocaleString() + '</td>' +
                    '<td><span class="sales-table-payment">' + paymentIcon + ' ' + sale.paymentMethod + '</span></td>' +
                    '<td class="sales-table-actions">' +
                        '<button class="btn-icon btn-detail" onclick="toggleDetail(' + sale.id + ')">è©³ç´°</button>' +
                        '<button class="btn-icon btn-edit" onclick="editSale(' + sale.id + ')">ç·¨é›†</button>' +
                        '<button class="btn-icon btn-delete" onclick="deleteSale(' + sale.id + ')">å‰Šé™¤</button>' +
                    '</td>' +
                '</tr>' +
                '<tr class="sales-detail-row" id="detail-' + sale.id + '" style="display: none;">' +
                    '<td colspan="5" class="sales-detail-cell">' +
                        '<div style="font-weight: 700; margin-bottom: 10px; color: #667eea;">ğŸ“¦ å•†å“æ˜ç´°</div>';
                
                // v13.6.3: sale.itemsãŒå­˜åœ¨ã™ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
                if (sale.items && sale.items.length > 0) {
                    for (var j = 0; j < sale.items.length; j++) {
                        var item = sale.items[j];
                        tableHTML += '<div class="detail-item">' +
                            '<div>' +
                                '<span class="detail-category">' + item.category + '</span>' +
                                '<span class="detail-product">' + item.productName + '</span>' +
                            '</div>' +
                            '<div class="detail-price">' +
                                item.quantity + 'å€‹ Ã— Â¥' + item.unitPrice.toLocaleString() + ' = Â¥' + item.subtotal.toLocaleString() +
                            '</div>' +
                        '</div>';
                    }
                } else {
                    tableHTML += '<div style="color: #999; padding: 10px;">æ˜ç´°ãƒ‡ãƒ¼ã‚¿ãªã—</div>';
                }
                
                tableHTML += '</td></tr>';
            }
            
            tableHTML += '</tbody></table>';
            listContainer.innerHTML = tableHTML;
        }

        // è©³ç´°è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
        function toggleDetail(id) {
            var detailRow = document.getElementById('detail-' + id);
            if (detailRow.style.display === 'none') {
                detailRow.style.display = 'table-row';
            } else {
                detailRow.style.display = 'none';
            }
        }

        // ç·¨é›†
        function editSale(id) {
            var sale = salesData.find(function(item) { return item.id === id; });
            if (!sale) return;
            
            editingId = id;
            document.getElementById('sale-date').value = sale.date;
            document.getElementById('customer-name').value = sale.customerName;
            
            var paymentOptions = document.querySelectorAll('.payment-option');
            for (var i = 0; i < paymentOptions.length; i++) {
                if (paymentOptions[i].getAttribute('data-value') === sale.paymentMethod) {
                    paymentOptions[i].classList.add('selected');
                    document.getElementById('payment-method').value = sale.paymentMethod;
                }
            }
            
            var container = document.getElementById('items-container');
            container.innerHTML = '';
            itemCounter = 0;
            
            for (var i = 0; i < sale.items.length; i++) {
                addItemRow();
                var itemRow = document.querySelectorAll('.item-row')[i];
                itemRow.querySelector('.item-category').value = sale.items[i].category;
                itemRow.querySelector('.item-product-name').value = sale.items[i].productName;
                itemRow.querySelector('.item-quantity').value = sale.items[i].quantity;
                itemRow.querySelector('.item-unit-price').value = sale.items[i].unitPrice;
                itemRow.querySelector('.item-subtotal').value = sale.items[i].subtotal;
            }
            
            updateGrandTotal();
            switchTab('input');
            showNotification('ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆã¾ã—ãŸ');
        }

        // å‰Šé™¤
        function deleteSale(id) {
            if (!confirm('æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
            
            salesData = salesData.filter(function(item) { return item.id !== id; });
            localStorage.setItem('salonSalesData', JSON.stringify(salesData));
            
            showNotification('å‰Šé™¤ã—ã¾ã—ãŸ');
            renderSalesList();
            renderDashboard();
            calculateDailyWeeklyMonthlySales();
            renderYearlyMonthlySales();
            renderMonthlyDailySales();
        }

        // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¡¨ç¤º
        // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰: ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ï¼ˆv13.13ï¼‰
        var dashboardStartYear = new Date().getFullYear();
        var dashboardStartMonth = new Date().getMonth() + 1;
        var dashboardEndYear = new Date().getFullYear();
        var dashboardEndMonth = new Date().getMonth() + 1;
        
        function renderDashboard() {
            // v13.13: é–‹å§‹å¹´æœˆã€œçµ‚äº†å¹´æœˆã§æœŸé–“ã‚’è¨ˆç®—
            var periodStart = dashboardStartYear + '-' + String(dashboardStartMonth).padStart(2, '0') + '-01';
            var lastDay = new Date(dashboardEndYear, dashboardEndMonth, 0).getDate();
            var periodEnd = dashboardEndYear + '-' + String(dashboardEndMonth).padStart(2, '0') + '-' + String(lastDay).padStart(2, '0');
            
            console.log('ğŸ“ˆ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æœŸé–“:', periodStart, '~', periodEnd);
            
            var filteredData = salesData.filter(function(sale) {
                if (sale.date < periodStart) return false;
                if (sale.date > periodEnd) return false;
                return true;
            });
            
            // ç·å£²ä¸Šãƒ»å–å¼•ä»¶æ•°ãƒ»å¹³å‡å–å¼•é¡
            // v13.13: å–å¼•ä»¶æ•° = æ˜ç´°ï¼ˆitemsï¼‰ã®åˆè¨ˆæ•°
            var totalSales = 0;
            var totalTransactions = 0;
            
            for (var i = 0; i < filteredData.length; i++) {
                var sale = filteredData[i];
                totalSales += sale.totalAmount;
                // æ˜ç´°æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
                if (sale.items && sale.items.length > 0) {
                    totalTransactions += sale.items.length;
                }
            }
            
            var averageTransaction = totalTransactions > 0 ? Math.floor(totalSales / totalTransactions) : 0;
            
            document.getElementById('total-sales').textContent = 'Â¥' + totalSales.toLocaleString();
            document.getElementById('total-transactions').textContent = totalTransactions + 'ä»¶';
            document.getElementById('average-transaction').textContent = 'Â¥' + averageTransaction.toLocaleString();
            
            
            // v13.13: é¡§å®¢æ•°ã¨å¹³å‡é¡§å®¢å˜ä¾¡ã‚’è¨ˆç®—
            var customerStats = {};
            for (var i = 0; i < filteredData.length; i++) {
                var sale = filteredData[i];
                if (!customerStats[sale.customerName]) {
                    customerStats[sale.customerName] = 0;
                }
                customerStats[sale.customerName] += sale.totalAmount;
            }
            
            var customerCount = Object.keys(customerStats).length;
            var averageCustomerSpending = customerCount > 0 ? Math.floor(totalSales / customerCount) : 0;
            
            document.getElementById('customer-count').textContent = customerCount + 'äºº';
            document.getElementById('average-customer-spending').textContent = 'Â¥' + averageCustomerSpending.toLocaleString();
            
            console.log('ğŸ“Š ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æŒ‡æ¨™:');
            console.log("ğŸ“Š å–å¼•ä»¶æ•°:", totalTransactions, "ä»¶ | é¡§å®¢æ•°:", customerCount, "äºº | âœ…", totalTransactions >= customerCount ? "æ­£å¸¸" : "ç•°å¸¸");
            // v13.13: æ±ºæ¸ˆæ–¹æ³•åˆ¥åˆ†æï¼ˆãƒãƒˆãƒªãƒƒã‚¯ã‚¹è¡¨ + å††ã‚°ãƒ©ãƒ•ï¼‰
            var paymentStats = {
                'ç¾é‡‘': { total: 0, count: 0 },
                'æŒ¯è¾¼': { total: 0, count: 0 },
                'ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰': { total: 0, count: 0 }
            };
            
            for (var i = 0; i < filteredData.length; i++) {
                var sale = filteredData[i];
                var method = sale.paymentMethod;
                if (paymentStats[method]) {
                    paymentStats[method].total += sale.totalAmount;
                    // å–å¼•ä»¶æ•° = æ˜ç´°æ•°
                    if (sale.items && sale.items.length > 0) {
                        paymentStats[method].count += sale.items.length;
                    }
                }
            }
            
            // ãƒãƒˆãƒªãƒƒã‚¯ã‚¹è¡¨ã‚’ç”Ÿæˆ
            var matrixHTML = '';
            var paymentMethods = ['ç¾é‡‘', 'æŒ¯è¾¼', 'ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰'];
            var totalAllPayments = paymentStats['ç¾é‡‘'].total + paymentStats['æŒ¯è¾¼'].total + paymentStats['ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰'].total;
            
            for (var i = 0; i < paymentMethods.length; i++) {
                var method = paymentMethods[i];
                var stats = paymentStats[method];
                var ratio = totalAllPayments > 0 ? (stats.total / totalAllPayments * 100).toFixed(1) : 0;
                
                var icon = method === 'ç¾é‡‘' ? 'ğŸ’µ' : (method === 'æŒ¯è¾¼' ? 'ğŸ¦' : 'ğŸ’³');
                var bgColor = i % 2 === 0 ? '#f9fafb' : 'white';
                
                matrixHTML += '<tr style="background: ' + bgColor + ';">' +
                    '<td style="padding: 15px; font-weight: 600; color: #667eea; font-size: 15px;">' + icon + ' ' + method + '</td>' +
                    '<td style="padding: 15px; text-align: right; font-weight: 700; font-size: 16px; color: #333;">Â¥' + stats.total.toLocaleString() + '</td>' +
                    '<td style="padding: 15px; text-align: right; font-weight: 600; font-size: 15px; color: #666;">' + stats.count + 'ä»¶</td>' +
                    '<td style="padding: 15px; text-align: right; font-weight: 700; font-size: 16px; color: #667eea;">' + ratio + '%</td>' +
                '</tr>';
            }
            
            document.getElementById('payment-matrix-body').innerHTML = matrixHTML;
            
            // å††ã‚°ãƒ©ãƒ•ã‚’æç”»
            var canvas = document.getElementById('payment-pie-chart');
            if (canvas && canvas.getContext) {
                var ctx = canvas.getContext('2d');
                var centerX = 125;
                var centerY = 125;
                var radius = 100;
                
                var colors = ['#10b981', '#f59e0b', '#667eea']; // ç¾é‡‘=ç·‘, æŒ¯è¾¼=ã‚ªãƒ¬ãƒ³ã‚¸, ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ=ç´«
                var data = [
                    paymentStats['ç¾é‡‘'].total,
                    paymentStats['æŒ¯è¾¼'].total,
                    paymentStats['ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰'].total
                ];
                
                var total = data[0] + data[1] + data[2];
                var startAngle = -Math.PI / 2; // 12æ™‚ã®ä½ç½®ã‹ã‚‰é–‹å§‹
                
                ctx.clearRect(0, 0, 250, 250);
                
                if (total > 0) {
                    for (var i = 0; i < data.length; i++) {
                        var sliceAngle = (data[i] / total) * 2 * Math.PI;
                        
                        ctx.beginPath();
                        ctx.moveTo(centerX, centerY);
                        ctx.arc(centerX, centerY, radius, startAngle, startAngle + sliceAngle);
                        ctx.closePath();
                        ctx.fillStyle = colors[i];
                        ctx.fill();
                        
                        // æ ç·š
                        ctx.strokeStyle = 'white';
                        ctx.lineWidth = 3;
                        ctx.stroke();
                        
                        startAngle += sliceAngle;
                    }
                } else {
                    // ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã¯ã‚°ãƒ¬ãƒ¼ã®å††
                    ctx.beginPath();
                    ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
                    ctx.fillStyle = '#e5e7eb';
                    ctx.fill();
                }
            }
            var categoryStats = {};
            
            // v13.13: å‡¡ä¾‹ã‚’ç”Ÿæˆ
            var legendHTML = '';
            var paymentMethods = ['ç¾é‡‘', 'æŒ¯è¾¼', 'ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰'];
            var icons = ['ğŸ’µ', 'ğŸ¦', 'ğŸ’³'];
            var colors = ['#10b981', '#f59e0b', '#667eea'];
            
            for (var i = 0; i < paymentMethods.length; i++) {
                var method = paymentMethods[i];
                var stats = paymentStats[method];
                var ratio = totalAllPayments > 0 ? (stats.total / totalAllPayments * 100).toFixed(1) : 0;
                
                legendHTML += '<div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; padding: 8px; background: #f9fafb; border-radius: 6px;">' +
                    '<div style="display: flex; align-items: center; gap: 8px;">' +
                    '<div style="width: 16px; height: 16px; background: ' + colors[i] + '; border-radius: 3px;"></div>' +
                    '<span style="font-size: 14px; font-weight: 600; color: #333;">' + icons[i] + ' ' + method + '</span>' +
                    '</div>' +
                    '<span style="font-size: 16px; font-weight: 700; color: ' + colors[i] + ';">' + ratio + '%</span>' +
                    '</div>';
            }
            
            document.getElementById('payment-legend').innerHTML = legendHTML;
            for (var i = 0; i < filteredData.length; i++) {
                var sale = filteredData[i];
                if (sale.items && sale.items.length > 0) {
                    for (var j = 0; j < sale.items.length; j++) {
                        var item = sale.items[j];
                        if (!categoryStats[item.category]) {
                            categoryStats[item.category] = { count: 0, sales: 0 };
                        }
                        categoryStats[item.category].count++;
                        categoryStats[item.category].sales += item.subtotal;
                    }
                }
            }
            
            var categoryRanking = Object.keys(categoryStats).map(function(category) {
                return {
                    name: category,
                    count: categoryStats[category].count,
                    sales: categoryStats[category].sales
                };
            }).sort(function(a, b) {
                return b.sales - a.sales;
            }).slice(0, 10);
            
            var categoryRankingHTML = '';
            for (var i = 0; i < categoryRanking.length; i++) {
                var item = categoryRanking[i];
                categoryRankingHTML += '<div class="ranking-item">' +
                    '<div class="ranking-number">' + (i + 1) + '</div>' +
                    '<div class="ranking-name">' + item.name + '</div>' +
                    '<div class="ranking-count">' + item.count + 'ä»¶</div>' +
                    '<div class="ranking-value">Â¥' + item.sales.toLocaleString() + '</div>' +
                '</div>';
            }
            document.getElementById('category-ranking').innerHTML = categoryRankingHTML || '<div class="empty-state">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>';
            
            // å•†å“åˆ¥ãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼ˆv13.6.4ã§ä¿®æ­£ï¼‰
            var productStats = {};
            for (var i = 0; i < filteredData.length; i++) {
                var sale = filteredData[i];
                if (sale.items && sale.items.length > 0) {
                    for (var j = 0; j < sale.items.length; j++) {
                        var item = sale.items[j];
                        var key = item.category + ' - ' + item.productName;
                        if (!productStats[key]) {
                            productStats[key] = { count: 0, sales: 0 };
                        }
                        productStats[key].count++;
                        productStats[key].sales += item.subtotal;
                    }
                }
            }
            
            var productRanking = Object.keys(productStats).map(function(product) {
                return {
                    name: product,
                    count: productStats[product].count,
                    sales: productStats[product].sales
                };
            }).sort(function(a, b) {
                return b.sales - a.sales;
            }).slice(0, 10);
            
            var productRankingHTML = '';
            for (var i = 0; i < productRanking.length; i++) {
                var item = productRanking[i];
                productRankingHTML += '<div class="ranking-item">' +
                    '<div class="ranking-number">' + (i + 1) + '</div>' +
                    '<div class="ranking-name">' + item.name + '</div>' +
                    '<div class="ranking-count">' + item.count + 'ä»¶</div>' +
                    '<div class="ranking-value">Â¥' + item.sales.toLocaleString() + '</div>' +
                '</div>';
            }
            document.getElementById('product-ranking').innerHTML = productRankingHTML || '<div class="empty-state">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>';
            
            // ãŠå®¢æ§˜åˆ¥ãƒ©ãƒ³ã‚­ãƒ³ã‚°
            var customerStats = {};
            for (var i = 0; i < filteredData.length; i++) {
                var sale = filteredData[i];
                if (!customerStats[sale.customerName]) {
                    customerStats[sale.customerName] = { count: 0, sales: 0 };
                }
                customerStats[sale.customerName].count++;
                customerStats[sale.customerName].sales += sale.totalAmount;
            }
            
            var customerRanking = Object.keys(customerStats).map(function(customer) {
                return {
                    name: customer,
                    count: customerStats[customer].count,
                    sales: customerStats[customer].sales
                };
            }).sort(function(a, b) {
                return b.sales - a.sales;
            }).slice(0, 10);
            
            var customerRankingHTML = '';
            for (var i = 0; i < customerRanking.length; i++) {
                var item = customerRanking[i];
                customerRankingHTML += '<div class="ranking-item">' +
                    '<div class="ranking-number">' + (i + 1) + '</div>' +
                    '<div class="ranking-name">' + item.name + '</div>' +
                    '<div class="ranking-count">' + item.count + 'å›</div>' +
                    '<div class="ranking-value">Â¥' + item.sales.toLocaleString() + '</div>' +
                '</div>';
            }
            document.getElementById('customer-ranking').innerHTML = customerRankingHTML || '<div class="empty-state">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>';
            
            // æ—¥åˆ¥å£²ä¸Š
            var dailyStats = {};
            for (var i = 0; i < filteredData.length; i++) {
                var sale = filteredData[i];
                if (!dailyStats[sale.date]) {
                    dailyStats[sale.date] = { count: 0, sales: 0 };
                }
                dailyStats[sale.date].count++;
                dailyStats[sale.date].sales += sale.totalAmount;
            }
            
            var dailySales = Object.keys(dailyStats).map(function(date) {
                return {
                    date: date,
                    count: dailyStats[date].count,
                    sales: dailyStats[date].sales
                };
            }).sort(function(a, b) {
                return b.date.localeCompare(a.date);
            });
            
            var dailyTableHTML = '';
            for (var i = 0; i < dailySales.length; i++) {
                var day = dailySales[i];
                dailyTableHTML += '<tr>' +
                    '<td style="font-weight: 600; color: #667eea;">' + day.date + '</td>' +
                    '<td style="font-weight: 700; color: #333;">Â¥' + day.sales.toLocaleString() + '</td>' +
                    '<td style="color: #666;">' + day.count + 'ä»¶</td>' +
                '</tr>';
            }
            document.getElementById('daily-sales-table').querySelector('tbody').innerHTML = 
                dailyTableHTML || '<tr><td colspan="3" class="empty-state">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>';
        }

        // v13.13: ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æœŸé–“é¸æŠãƒ‘ãƒãƒ«ã‚’é–‹ã/é–‰ã˜ã‚‹ï¼ˆAæ¡ˆ: ãƒ‡ãƒ¼ãƒˆãƒ”ãƒƒã‚«ãƒ¼æ–¹å¼ï¼‰
        function toggleDashboardPeriodSelector() {
            var panel = document.getElementById('dashboard-period-panel');
            var btn = document.getElementById('dashboard-period-btn');
            
            if (panel.style.display === 'none') {
                // ãƒ‘ãƒãƒ«ã‚’é–‹ã
                // ç¾åœ¨ã®å¹´æœˆã‚’ãƒ‡ãƒ¼ãƒˆãƒ”ãƒƒã‚«ãƒ¼ã«è¨­å®š
                var startPeriod = dashboardStartYear + '-' + String(dashboardStartMonth).padStart(2, '0');
                var endPeriod = dashboardEndYear + '-' + String(dashboardEndMonth).padStart(2, '0');
                
                document.getElementById('dashboard-start-period').value = startPeriod;
                document.getElementById('dashboard-end-period').value = endPeriod;
                
                panel.style.display = 'block';
                btn.textContent = 'âŒ æœŸé–“é¸æŠã‚’é–‰ã˜ã‚‹';
            } else {
                // ãƒ‘ãƒãƒ«ã‚’é–‰ã˜ã‚‹
                panel.style.display = 'none';
                btn.textContent = 'ğŸ“… æœŸé–“æŒ‡å®š';
            }
        }
        
        // v13.13: æœŸé–“é¸æŠæ™‚ã«è¡¨ç¤ºã‚’æ›´æ–°ï¼ˆAæ¡ˆ: ãƒ‡ãƒ¼ãƒˆãƒ”ãƒƒã‚«ãƒ¼æ–¹å¼ï¼‰
        function updateDashboardDisplay() {
            var startPeriod = document.getElementById('dashboard-start-period').value; // YYYY-MMå½¢å¼
            var endPeriod = document.getElementById('dashboard-end-period').value; // YYYY-MMå½¢å¼
            
            if (!startPeriod || !endPeriod) return;
            
            var startParts = startPeriod.split('-');
            var endParts = endPeriod.split('-');
            var startYear = parseInt(startParts[0]);
            var startMonth = parseInt(startParts[1]);
            var endYear = parseInt(endParts[0]);
            var endMonth = parseInt(endParts[1]);
            
            // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§è¡¨ç¤ºã‚’æ›´æ–°
            document.getElementById('dashboard-period-display').textContent = 
                startYear + 'å¹´' + startMonth + 'æœˆ ã€œ ' + endYear + 'å¹´' + endMonth + 'æœˆ';
        }
        
        // v13.13: ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æœŸé–“ã‚’é©ç”¨ï¼ˆAæ¡ˆ: ãƒ‡ãƒ¼ãƒˆãƒ”ãƒƒã‚«ãƒ¼æ–¹å¼ï¼‰
        function applyDashboardPeriod() {
            var startPeriod = document.getElementById('dashboard-start-period').value; // YYYY-MMå½¢å¼
            var endPeriod = document.getElementById('dashboard-end-period').value; // YYYY-MMå½¢å¼
            
            if (!startPeriod || !endPeriod) {
                showNotification('é–‹å§‹å¹´æœˆã¨çµ‚äº†å¹´æœˆã‚’é¸æŠã—ã¦ãã ã•ã„', 'error');
                return;
            }
            
            var startParts = startPeriod.split('-');
            var endParts = endPeriod.split('-');
            dashboardStartYear = parseInt(startParts[0]);
            dashboardStartMonth = parseInt(startParts[1]);
            dashboardEndYear = parseInt(endParts[0]);
            dashboardEndMonth = parseInt(endParts[1]);
            
            // æœŸé–“è¡¨ç¤ºã‚’æ›´æ–°
            document.getElementById('dashboard-period-display').textContent = 
                dashboardStartYear + 'å¹´' + dashboardStartMonth + 'æœˆ ã€œ ' + dashboardEndYear + 'å¹´' + dashboardEndMonth + 'æœˆ';
            
            // ãƒ‘ãƒãƒ«ã‚’é–‰ã˜ã‚‹
            toggleDashboardPeriodSelector();
            
            // ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°
            console.log('ğŸ“… ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æœŸé–“ã‚’æ›´æ–°:', dashboardStartYear + 'å¹´' + dashboardStartMonth + 'æœˆ ã€œ ' + dashboardEndYear + 'å¹´' + dashboardEndMonth + 'æœˆ');
            
            // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’å†æç”»
            renderDashboard();
            
            showNotification('æœŸé–“ã‚’æ›´æ–°ã—ã¾ã—ãŸ', 'success');
        }
        
        // æœŸé–“ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é©ç”¨ï¼ˆæ—§é–¢æ•°ã€äº’æ›æ€§ã®ãŸã‚ä¿æŒï¼‰
        function applyPeriodFilter() {
            renderDashboard();
        }

        // æœŸé–“ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒªã‚»ãƒƒãƒˆï¼ˆæ—§é–¢æ•°ã€å‰Šé™¤äºˆå®šï¼‰
        function resetPeriodFilter() {
            dashboardStartYear = new Date().getFullYear();
            dashboardStartMonth = new Date().getMonth() + 1;
            dashboardEndYear = new Date().getFullYear();
            dashboardEndMonth = new Date().getMonth() + 1;
            document.getElementById('dashboard-period-display').textContent = 
                dashboardStartYear + 'å¹´' + dashboardStartMonth + 'æœˆ ã€œ ' + dashboardEndYear + 'å¹´' + dashboardEndMonth + 'æœˆ';
            renderDashboard();
        }

        // CSVå‡ºåŠ›
        function exportToCSV() {
            var csv = '\uFEFFæ—¥ä»˜,ãŠå®¢æ§˜å,ã‚«ãƒ†ã‚´ãƒªãƒ¼,å•†å“å,å€‹æ•°,å˜ä¾¡,å°è¨ˆ,åˆè¨ˆé‡‘é¡,æ±ºæ¸ˆæ–¹æ³•\n';
            
            for (var i = 0; i < salesData.length; i++) {
                var sale = salesData[i];
                for (var j = 0; j < sale.items.length; j++) {
                    var item = sale.items[j];
                    csv += sale.date + ',' +
                           sale.customerName + ',' +
                           item.category + ',' +
                           item.productName + ',' +
                           item.quantity + ',' +
                           item.unitPrice + ',' +
                           item.subtotal + ',' +
                           (j === 0 ? sale.totalAmount : '') + ',' +
                           (j === 0 ? sale.paymentMethod : '') + '\n';
                }
            }
            
            var blob = new Blob([csv], { type: 'text/csv' });
            var url = window.URL.createObjectURL(blob);
            var a = document.createElement('a');
            a.href = url;
            a.download = 'salon_sales_' + new Date().toISOString().split('T')[0] + '.csv';
            a.click();
            window.URL.revokeObjectURL(url);
            
            showNotification('CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ');
        }

        // ========== è¨­å®šã‚¿ãƒ–é–¢æ•°ï¼ˆv13.6ã§è¿½åŠ ï¼‰ ==========

        // GASæ¥ç¶šãƒ†ã‚¹ãƒˆ
        function testGASConnection() {
            console.log('ğŸ”Œ GASæ¥ç¶šãƒ†ã‚¹ãƒˆé–‹å§‹...');
            var testUrl = GAS_URL + '?action=test';
            console.log('ãƒ†ã‚¹ãƒˆURL:', testUrl);
            
            fetch(testUrl)
                .then(function(response) {
                    return response.json();
                })
                .then(function(data) {
                    console.log('âœ… æ¥ç¶šãƒ†ã‚¹ãƒˆæˆåŠŸ');
                    console.log('ãƒ¬ã‚¹ãƒãƒ³ã‚¹:', data);
                    showNotification('âœ… Google Sheetsæ¥ç¶šæˆåŠŸï¼');
                })
                .catch(function(error) {
                    console.error('âŒ æ¥ç¶šãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼:', error);
                    showNotification('âŒ æ¥ç¶šãƒ†ã‚¹ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                });
        }

        // LocalStorageã‹ã‚‰Google Sheetsã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
        function importToGoogleSheets() {
            if (salesData.length === 0) {
                showNotification('ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“', 'error');
                return;
            }
            
            if (!confirm(salesData.length + 'ä»¶ã®ãƒ‡ãƒ¼ã‚¿ã‚’Google Sheetsã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
                return;
            }
            
            console.log('â¬†ï¸ Google Sheetsã¸ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆé–‹å§‹:', salesData.length + 'ä»¶');
            
            var importData = {
                action: 'importData',
                data: salesData.map(function(sale) {
                    return {
                        id: String(sale.id),
                        date: sale.date,
                        customer: sale.customerName,
                        products: sale.items,
                        totalAmount: sale.totalAmount,
                        paymentMethod: sale.paymentMethod,
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    };
                })
            };
            
            fetch(GAS_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(importData)
            })
            .then(function() {
                console.log('âœ… ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Œäº†');
                showNotification('âœ… ' + salesData.length + 'ä»¶ã®ãƒ‡ãƒ¼ã‚¿ã‚’Google Sheetsã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ');
            })
            .catch(function(error) {
                console.error('âŒ ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼:', error);
                showNotification('âŒ ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            });
        }

        // å…¨ãƒ‡ãƒ¼ã‚¿å‰Šé™¤
        function deleteAllData() {
            if (!confirm('å…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) {
                return;
            }
            
            if (!confirm('æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼ŸGoogle Sheetsã®ãƒ‡ãƒ¼ã‚¿ã¯å‰Šé™¤ã•ã‚Œã¾ã›ã‚“ã€‚')) {
                return;
            }
            
            salesData = [];
            localStorage.removeItem('salonSalesData');
            
            console.log('ğŸ—‘ï¸ å…¨ãƒ‡ãƒ¼ã‚¿å‰Šé™¤å®Œäº†');
            showNotification('å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
            
            renderSalesList();
            renderDashboard();
            calculateDailyWeeklyMonthlySales();
            renderYearlyMonthlySales();
            renderMonthlyDailySales();
            updateLocalDataCount();
        }

        // LocalStorageãƒ‡ãƒ¼ã‚¿ä»¶æ•°æ›´æ–°
        function updateLocalDataCount() {
            document.getElementById('local-data-count').textContent = salesData.length + 'ä»¶';
        }
    </script>
</body>
</html>